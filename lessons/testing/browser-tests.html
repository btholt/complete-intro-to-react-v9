<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Browser Tests – Complete Intro to React</title><meta name="description" content="Explore the emerging support for browser-based testing with Vitest, featuring Playwright integration for fast and reliable testing. Learn how to configure Vitest for both Node.js and browser environments, leveraging libraries like vitest-browser-react, and gain insights from Brian Holt on crafting effective tests for user experiences in React applications. This guide is ideal for developers keen on improving their testing setups in modern web development environments."/><meta name="keywords" content="Vitest,Playwright,browser-based testing,React testing,vitest-browser-react,Brian Holt,web development"/><meta name="og:description" content="Explore the emerging support for browser-based testing with Vitest, featuring Playwright integration for fast and reliable testing. Learn how to configure Vitest for both Node.js and browser environments, leveraging libraries like vitest-browser-react, and gain insights from Brian Holt on crafting effective tests for user experiences in React applications. This guide is ideal for developers keen on improving their testing setups in modern web development environments."/><meta name="og:title" content="Browser Tests – Complete Intro to React"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2fea0762771cca66.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2fea0762771cca66.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-a6a08e1f60796d6f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8844ca430b4a38f8.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_buildManifest.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React</a></h1><div class="navbar-info"><a href="https://holt.fyi/react" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><blockquote>
<p>🚨 This is experimental and very likely to change in the future. Consider this a sneak peak into what is coming, not what to do today.</p>
</blockquote>
<p>Vitest is beginning to support more deeply browser-based testing. To those of us that have been around long enough to remember Selenium, this may strike fear deep int your heart. But fear not! Browser-based testing tools have come so far along since then that it&#39;s both fast and reliable, in particular thanks to the Microsoft project <a href="https://playwright.dev/">Playwright</a>.</p>
<p>However this is still early days. I&#39;m going to show you how to set it up but be warned that this prone to change as they&#39;re still actively working on it!</p>
<p>So first let&#39;s install the libraries we need.</p>
<pre><code class="hljs language-bash">npm i -D @vitest/browser@2.1.3 playwright@1.48.0 vitest-browser-react@0.0.1
</code></pre><p>You can see that the vitest-browser-react library is still 0.0.1 as of writing so be extra aware it&#39;s likely to have changed by the time you read this.</p>
<p>Okay, so now we want to write browser based tests. But we have also have a bunch of existing Node.js-based tests. Some our already-existing Node.js based tests won&#39;t work in the browser. But no worries, Vitest/Vite has a tool just for this, workspaces. It&#39;s actually made to handle monorepos, but it will work here just as well. Make a file called <code>vitest.workspace.js</code> (you don&#39;t normally need this as your Vite config is normally enough.)</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { defineWorkspace } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest/config&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineWorkspace</span>([
  {
    <span class="hljs-attr">extends</span>: <span class="hljs-string">&quot;./vite.config.js&quot;</span>,
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">include</span>: [<span class="hljs-string">&quot;**/*.node.test.{js,jsx}&quot;</span>],
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;happy-dom&quot;</span>,
      <span class="hljs-attr">environment</span>: <span class="hljs-string">&quot;happy-dom&quot;</span>,
    },
  },
  {
    <span class="hljs-attr">extends</span>: <span class="hljs-string">&quot;./vite.config.js&quot;</span>,
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">setupFiles</span>: [<span class="hljs-string">&quot;vitest-browser-react&quot;</span>],
      <span class="hljs-attr">include</span>: [<span class="hljs-string">&quot;**/*.browser.test.{js,jsx}&quot;</span>],
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;browser&quot;</span>,
      <span class="hljs-attr">browser</span>: {
        <span class="hljs-attr">provider</span>: <span class="hljs-string">&quot;playwright&quot;</span>,
        <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;firefox&quot;</span>, <span class="hljs-comment">// you can use chromium or webkit here too</span>
      },
    },
  },
]);
</code></pre><p>Now delete the <code>test</code> items from your vite.config.js file.</p>
<p>This is a test-only config for Vite (and therefore Vitest.) Now if a test ends in <code>.node.test.jsx</code> it will run through the happy-dom based environment and if it ends in <code>.browser.test.jsx</code> it will run in our new browser-based environment with Playwright. Let&#39;s go rename our tests to reflect that.</p>
<ul>
<li>Cart.browser.test.jsx</li>
<li>contact.lazy.node.test.jsx</li>
<li>Pizza.node.test.jsx</li>
<li>usePizzaOfTheDay.node.test.jsx</li>
</ul>
<p>Snapshotting works in the browser so that one works okay. Anything using vitest-fetch-mock is Node.js only so for those we need to mark them as node. We&#39;re going to make a new Pizza file so let&#39;s leave that one. And our custom hook test mocks fetch so that one is Node only.</p>
<p>Okay, now create a <code>Pizza.browser.test.jsx</code></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest-browser-react&quot;</span>;
<span class="hljs-keyword">import</span> { expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Pizza</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Pizza&quot;</span>;

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;alt text renders on image&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> name = <span class="hljs-string">&quot;My Favorite Pizza&quot;</span>;
  <span class="hljs-keyword">const</span> src = <span class="hljs-string">&quot;https://picsum.photos/200&quot;</span>;
  <span class="hljs-keyword">const</span> screen = <span class="hljs-title function_">render</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Pizza</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{name}</span> <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;super cool pizza&quot;</span> <span class="hljs-attr">image</span>=<span class="hljs-string">{src}</span> /&gt;</span></span>
  );

  <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">await</span> screen.<span class="hljs-title function_">getByRole</span>(<span class="hljs-string">&quot;img&quot;</span>);

  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(img).<span class="hljs-title function_">toBeInTheDocument</span>();
  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(img).<span class="hljs-title function_">toHaveAttribute</span>(<span class="hljs-string">&quot;src&quot;</span>, src);
  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(img).<span class="hljs-title function_">toHaveAttribute</span>(<span class="hljs-string">&quot;alt&quot;</span>, name);
});
</code></pre><ul>
<li><code>render</code> will take a React component and render it in a vacuum. You can then poke and prod it as you need to test it.</li>
<li>A big part of what Playwright and vitest-browser-react want you to do is not test implementation details but to test actual user experiences. Don&#39;t test the internal state of a React component but do test what users will see and experience. As such, a lot of we&#39;ll be testing will be around roles, attributes, etc.</li>
<li><a href="https://testing-library.com/docs/guiding-principles">@testing-library</a> has a good doc on why they choose to test this way.</li>
<li>In general, vitest-browser-react aims to be a drop in replacement for @testing-library/react.</li>
</ul>
<p>Looks really similar, right? Alright, let&#39;s run it. <code>npm run test</code>. You should see the same Vitest UI but now some of the tests are actually running in the browser.</p>
<blockquote>
<p>It will likely prompt you to run a command like <code>npx playwright install</code>. You&#39;ll install local copies of browsers to able to run them super fast.</p>
</blockquote>
<p>Cool, right? And really fast! Let&#39;s do one more. Let&#39;s make a <code>Header.jsx</code> test. We&#39;re going to test that the cart number is correct. Remember when Facebook notification numbers were always wrong? We&#39;re going to make sure that doesn&#39;t happen with our cart indicator. In your Header.jsx file:</p>
<pre><code class="hljs language-javascript">data-testid=<span class="hljs-string">&quot;cart-number&quot;</span> <span class="hljs-comment">// add to .nav-cart-number</span>
</code></pre><p>Now make a Header.browser.test.jsx</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest-browser-react&quot;</span>;
<span class="hljs-keyword">import</span> { expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Header&quot;</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">RouterProvider</span>,
  createRouter,
  createRootRoute,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/react-router&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CartContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../contexts&quot;</span>;

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;correctly renders a header with a zero cart count&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> rootRoute = <span class="hljs-title function_">createRootRoute</span>({
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CartContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{[[]]}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CartContext.Provider</span>&gt;</span></span>
    ),
  });

  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ <span class="hljs-attr">routeTree</span>: rootRoute });
  <span class="hljs-keyword">const</span> screen = <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{router}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">RouterProvider</span>&gt;</span></span>);

  <span class="hljs-keyword">const</span> itemsInCart = <span class="hljs-keyword">await</span> screen.<span class="hljs-title function_">getByTestId</span>(<span class="hljs-string">&quot;cart-number&quot;</span>);

  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(itemsInCart).<span class="hljs-title function_">toBeInTheDocument</span>();
  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(itemsInCart).<span class="hljs-title function_">toHaveTextContent</span>(<span class="hljs-string">&quot;0&quot;</span>);
});

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;correctly renders a header with a three cart count&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> rootRoute = <span class="hljs-title function_">createRootRoute</span>({
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CartContext.Provider</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{[[{</span> <span class="hljs-attr">pizza:</span> <span class="hljs-attr">1</span> }, { <span class="hljs-attr">pizza:</span> <span class="hljs-attr">2</span> }, { <span class="hljs-attr">pizza:</span> <span class="hljs-attr">3</span> }]]}
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CartContext.Provider</span>&gt;</span></span>
    ),
  });

  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ <span class="hljs-attr">routeTree</span>: rootRoute });
  <span class="hljs-keyword">const</span> screen = <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{router}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">RouterProvider</span>&gt;</span></span>);

  <span class="hljs-keyword">const</span> itemsInCart = <span class="hljs-keyword">await</span> screen.<span class="hljs-title function_">getByTestId</span>(<span class="hljs-string">&quot;cart-number&quot;</span>);

  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(itemsInCart).<span class="hljs-title function_">toBeInTheDocument</span>();
  <span class="hljs-keyword">await</span> expect.<span class="hljs-title function_">element</span>(itemsInCart).<span class="hljs-title function_">toHaveTextContent</span>(<span class="hljs-string">&quot;3&quot;</span>);
});
</code></pre><p>We do have to bend over a bit backwards to make sure TanStack Router is happy, hence all the making of root routes. Remember also that our cart gets its cart from context so we have to pass it in that way. Beyond that, it works very similar!</p>
<p>Again, these are early days for browser-based testing with Vite so proceed in your professional settings with caution. However the future is bright with Playwright!</p>
<blockquote>
<p>🚨 NOTE: If you want to add code coverage back into the project, you&#39;ll need to use Istanbul since, at the time of this recording, this wasn&#39;t supported in React 19 with V8</p>
</blockquote>
<p>First, you&#39;ll need to uninstall V8 and install Istanbul:</p>
<pre><code class="hljs language-bash">npm uninstall @vitest/coverage-v8@2.1.3
npm install -D @vitest/istanbul
</code></pre><p>Then move the coverage configuration to the <code>vitest.workspace.js</code> file:</p>
<pre><code class="hljs language-javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineWorkspace</span>([
  {
    <span class="hljs-attr">extends</span>: <span class="hljs-string">&quot;./vite.config.js&quot;</span>,
    <span class="hljs-attr">test</span>: {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-comment">// add to the end of the happy-dom test object </span>
      <span class="hljs-attr">coverage</span>: {
        <span class="hljs-attr">provider</span>: <span class="hljs-string">&quot;istanbul&quot;</span>
        <span class="hljs-attr">reporter</span>: [<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;json&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>],
      },
    },
  },
  {
    <span class="hljs-attr">extends</span>: <span class="hljs-string">&quot;./vite.config.js&quot;</span>,
    <span class="hljs-attr">test</span>: {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-comment">// add to the end of the browser test object </span>
      <span class="hljs-attr">coverage</span>: {
        <span class="hljs-attr">reporter</span>: [<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;json&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>],
      },
    },
  },
]);
</code></pre><blockquote>
<p>🏁 <a href="https://github.com/btholt/citr-v9-project/tree/master/14-testing">Click here to see the state of the project up until now: 14-testing</a></p>
</blockquote>
</div><div class="lesson-links"><a href="/lessons/testing/vitest-ui" class="prev">← Previous</a><a href="/lessons/whats-next/react-19" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Explore the emerging support for browser-based testing with Vitest, featuring Playwright integration for fast and reliable testing. Learn how to configure Vitest for both Node.js and browser environments, leveraging libraries like vitest-browser-react, and gain insights from Brian Holt on crafting effective tests for user experiences in React applications. This guide is ideal for developers keen on improving their testing setups in modern web development environments.","keywords":["Vitest","Playwright","browser-based testing","React testing","vitest-browser-react","Brian Holt","web development"]},"html":"\u003cblockquote\u003e\n\u003cp\u003e🚨 This is experimental and very likely to change in the future. Consider this a sneak peak into what is coming, not what to do today.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eVitest is beginning to support more deeply browser-based testing. To those of us that have been around long enough to remember Selenium, this may strike fear deep int your heart. But fear not! Browser-based testing tools have come so far along since then that it\u0026#39;s both fast and reliable, in particular thanks to the Microsoft project \u003ca href=\"https://playwright.dev/\"\u003ePlaywright\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eHowever this is still early days. I\u0026#39;m going to show you how to set it up but be warned that this prone to change as they\u0026#39;re still actively working on it!\u003c/p\u003e\n\u003cp\u003eSo first let\u0026#39;s install the libraries we need.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm i -D @vitest/browser@2.1.3 playwright@1.48.0 vitest-browser-react@0.0.1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eYou can see that the vitest-browser-react library is still 0.0.1 as of writing so be extra aware it\u0026#39;s likely to have changed by the time you read this.\u003c/p\u003e\n\u003cp\u003eOkay, so now we want to write browser based tests. But we have also have a bunch of existing Node.js-based tests. Some our already-existing Node.js based tests won\u0026#39;t work in the browser. But no worries, Vitest/Vite has a tool just for this, workspaces. It\u0026#39;s actually made to handle monorepos, but it will work here just as well. Make a file called \u003ccode\u003evitest.workspace.js\u003c/code\u003e (you don\u0026#39;t normally need this as your Vite config is normally enough.)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { defineWorkspace } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edefineWorkspace\u003c/span\u003e([\n  {\n    \u003cspan class=\"hljs-attr\"\u003eextends\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./vite.config.js\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003einclude\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;**/*.node.test.{js,jsx}\u0026quot;\u003c/span\u003e],\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;happy-dom\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eenvironment\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;happy-dom\u0026quot;\u003c/span\u003e,\n    },\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003eextends\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./vite.config.js\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003esetupFiles\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest-browser-react\u0026quot;\u003c/span\u003e],\n      \u003cspan class=\"hljs-attr\"\u003einclude\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;**/*.browser.test.{js,jsx}\u0026quot;\u003c/span\u003e],\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;browser\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003ebrowser\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003eprovider\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;playwright\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eenabled\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;firefox\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// you can use chromium or webkit here too\u003c/span\u003e\n      },\n    },\n  },\n]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow delete the \u003ccode\u003etest\u003c/code\u003e items from your vite.config.js file.\u003c/p\u003e\n\u003cp\u003eThis is a test-only config for Vite (and therefore Vitest.) Now if a test ends in \u003ccode\u003e.node.test.jsx\u003c/code\u003e it will run through the happy-dom based environment and if it ends in \u003ccode\u003e.browser.test.jsx\u003c/code\u003e it will run in our new browser-based environment with Playwright. Let\u0026#39;s go rename our tests to reflect that.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCart.browser.test.jsx\u003c/li\u003e\n\u003cli\u003econtact.lazy.node.test.jsx\u003c/li\u003e\n\u003cli\u003ePizza.node.test.jsx\u003c/li\u003e\n\u003cli\u003eusePizzaOfTheDay.node.test.jsx\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSnapshotting works in the browser so that one works okay. Anything using vitest-fetch-mock is Node.js only so for those we need to mark them as node. We\u0026#39;re going to make a new Pizza file so let\u0026#39;s leave that one. And our custom hook test mocks fetch so that one is Node only.\u003c/p\u003e\n\u003cp\u003eOkay, now create a \u003ccode\u003ePizza.browser.test.jsx\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { render } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest-browser-react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { expect, test } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePizza\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../Pizza\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;alt text renders on image\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\u0026quot;My Favorite Pizza\u0026quot;\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e src = \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://picsum.photos/200\u0026quot;\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e screen = \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ePizza\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{name}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;super cool pizza\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eimage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{src}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e img = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e screen.\u003cspan class=\"hljs-title function_\"\u003egetByRole\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;img\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(img).\u003cspan class=\"hljs-title function_\"\u003etoBeInTheDocument\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(img).\u003cspan class=\"hljs-title function_\"\u003etoHaveAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;src\u0026quot;\u003c/span\u003e, src);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(img).\u003cspan class=\"hljs-title function_\"\u003etoHaveAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;alt\u0026quot;\u003c/span\u003e, name);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003erender\u003c/code\u003e will take a React component and render it in a vacuum. You can then poke and prod it as you need to test it.\u003c/li\u003e\n\u003cli\u003eA big part of what Playwright and vitest-browser-react want you to do is not test implementation details but to test actual user experiences. Don\u0026#39;t test the internal state of a React component but do test what users will see and experience. As such, a lot of we\u0026#39;ll be testing will be around roles, attributes, etc.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://testing-library.com/docs/guiding-principles\"\u003e@testing-library\u003c/a\u003e has a good doc on why they choose to test this way.\u003c/li\u003e\n\u003cli\u003eIn general, vitest-browser-react aims to be a drop in replacement for @testing-library/react.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLooks really similar, right? Alright, let\u0026#39;s run it. \u003ccode\u003enpm run test\u003c/code\u003e. You should see the same Vitest UI but now some of the tests are actually running in the browser.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIt will likely prompt you to run a command like \u003ccode\u003enpx playwright install\u003c/code\u003e. You\u0026#39;ll install local copies of browsers to able to run them super fast.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCool, right? And really fast! Let\u0026#39;s do one more. Let\u0026#39;s make a \u003ccode\u003eHeader.jsx\u003c/code\u003e test. We\u0026#39;re going to test that the cart number is correct. Remember when Facebook notification numbers were always wrong? We\u0026#39;re going to make sure that doesn\u0026#39;t happen with our cart indicator. In your Header.jsx file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edata-testid=\u003cspan class=\"hljs-string\"\u003e\u0026quot;cart-number\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// add to .nav-cart-number\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow make a Header.browser.test.jsx\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { render } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest-browser-react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { expect, test } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHeader\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../Header\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {\n  \u003cspan class=\"hljs-title class_\"\u003eRouterProvider\u003c/span\u003e,\n  createRouter,\n  createRootRoute,\n} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/react-router\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eCartContext\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../contexts\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;correctly renders a header with a zero cart count\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e rootRoute = \u003cspan class=\"hljs-title function_\"\u003ecreateRootRoute\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eCartContext.Provider\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{[[]]}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHeader\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eCartContext.Provider\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    ),\n  });\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = \u003cspan class=\"hljs-title function_\"\u003ecreateRouter\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003erouteTree\u003c/span\u003e: rootRoute });\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e screen = \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRouterProvider\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{router}\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eRouterProvider\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e itemsInCart = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e screen.\u003cspan class=\"hljs-title function_\"\u003egetByTestId\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;cart-number\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(itemsInCart).\u003cspan class=\"hljs-title function_\"\u003etoBeInTheDocument\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(itemsInCart).\u003cspan class=\"hljs-title function_\"\u003etoHaveTextContent\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e);\n});\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;correctly renders a header with a three cart count\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e rootRoute = \u003cspan class=\"hljs-title function_\"\u003ecreateRootRoute\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eCartContext.Provider\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{[[{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epizza:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e1\u003c/span\u003e }, { \u003cspan class=\"hljs-attr\"\u003epizza:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e2\u003c/span\u003e }, { \u003cspan class=\"hljs-attr\"\u003epizza:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e3\u003c/span\u003e }]]}\n      \u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHeader\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eCartContext.Provider\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    ),\n  });\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = \u003cspan class=\"hljs-title function_\"\u003ecreateRouter\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003erouteTree\u003c/span\u003e: rootRoute });\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e screen = \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRouterProvider\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{router}\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eRouterProvider\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e itemsInCart = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e screen.\u003cspan class=\"hljs-title function_\"\u003egetByTestId\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;cart-number\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(itemsInCart).\u003cspan class=\"hljs-title function_\"\u003etoBeInTheDocument\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e expect.\u003cspan class=\"hljs-title function_\"\u003eelement\u003c/span\u003e(itemsInCart).\u003cspan class=\"hljs-title function_\"\u003etoHaveTextContent\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;3\u0026quot;\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWe do have to bend over a bit backwards to make sure TanStack Router is happy, hence all the making of root routes. Remember also that our cart gets its cart from context so we have to pass it in that way. Beyond that, it works very similar!\u003c/p\u003e\n\u003cp\u003eAgain, these are early days for browser-based testing with Vite so proceed in your professional settings with caution. However the future is bright with Playwright!\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e🚨 NOTE: If you want to add code coverage back into the project, you\u0026#39;ll need to use Istanbul since, at the time of this recording, this wasn\u0026#39;t supported in React 19 with V8\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFirst, you\u0026#39;ll need to uninstall V8 and install Istanbul:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm uninstall @vitest/coverage-v8@2.1.3\nnpm install -D @vitest/istanbul\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThen move the coverage configuration to the \u003ccode\u003evitest.workspace.js\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edefineWorkspace\u003c/span\u003e([\n  {\n    \u003cspan class=\"hljs-attr\"\u003eextends\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./vite.config.js\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: {\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// add to the end of the happy-dom test object \u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ecoverage\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003eprovider\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;istanbul\u0026quot;\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ereporter\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;json\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;html\u0026quot;\u003c/span\u003e],\n      },\n    },\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003eextends\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./vite.config.js\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: {\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// add to the end of the browser test object \u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ecoverage\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003ereporter\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;json\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;html\u0026quot;\u003c/span\u003e],\n      },\n    },\n  },\n]);\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e🏁 \u003ca href=\"https://github.com/btholt/citr-v9-project/tree/master/14-testing\"\u003eClick here to see the state of the project up until now: 14-testing\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","markdown":"\n\u003e 🚨 This is experimental and very likely to change in the future. Consider this a sneak peak into what is coming, not what to do today.\n\nVitest is beginning to support more deeply browser-based testing. To those of us that have been around long enough to remember Selenium, this may strike fear deep int your heart. But fear not! Browser-based testing tools have come so far along since then that it's both fast and reliable, in particular thanks to the Microsoft project [Playwright][playwright].\n\nHowever this is still early days. I'm going to show you how to set it up but be warned that this prone to change as they're still actively working on it!\n\nSo first let's install the libraries we need.\n\n```bash\nnpm i -D @vitest/browser@2.1.3 playwright@1.48.0 vitest-browser-react@0.0.1\n```\n\nYou can see that the vitest-browser-react library is still 0.0.1 as of writing so be extra aware it's likely to have changed by the time you read this.\n\nOkay, so now we want to write browser based tests. But we have also have a bunch of existing Node.js-based tests. Some our already-existing Node.js based tests won't work in the browser. But no worries, Vitest/Vite has a tool just for this, workspaces. It's actually made to handle monorepos, but it will work here just as well. Make a file called `vitest.workspace.js` (you don't normally need this as your Vite config is normally enough.)\n\n```javascript\nimport { defineWorkspace } from \"vitest/config\";\n\nexport default defineWorkspace([\n  {\n    extends: \"./vite.config.js\",\n    test: {\n      include: [\"**/*.node.test.{js,jsx}\"],\n      name: \"happy-dom\",\n      environment: \"happy-dom\",\n    },\n  },\n  {\n    extends: \"./vite.config.js\",\n    test: {\n      setupFiles: [\"vitest-browser-react\"],\n      include: [\"**/*.browser.test.{js,jsx}\"],\n      name: \"browser\",\n      browser: {\n        provider: \"playwright\",\n        enabled: true,\n        name: \"firefox\", // you can use chromium or webkit here too\n      },\n    },\n  },\n]);\n```\n\nNow delete the `test` items from your vite.config.js file.\n\nThis is a test-only config for Vite (and therefore Vitest.) Now if a test ends in `.node.test.jsx` it will run through the happy-dom based environment and if it ends in `.browser.test.jsx` it will run in our new browser-based environment with Playwright. Let's go rename our tests to reflect that.\n\n- Cart.browser.test.jsx\n- contact.lazy.node.test.jsx\n- Pizza.node.test.jsx\n- usePizzaOfTheDay.node.test.jsx\n\nSnapshotting works in the browser so that one works okay. Anything using vitest-fetch-mock is Node.js only so for those we need to mark them as node. We're going to make a new Pizza file so let's leave that one. And our custom hook test mocks fetch so that one is Node only.\n\nOkay, now create a `Pizza.browser.test.jsx`\n\n```javascript\nimport { render } from \"vitest-browser-react\";\nimport { expect, test } from \"vitest\";\nimport Pizza from \"../Pizza\";\n\ntest(\"alt text renders on image\", async () =\u003e {\n  const name = \"My Favorite Pizza\";\n  const src = \"https://picsum.photos/200\";\n  const screen = render(\n    \u003cPizza name={name} description=\"super cool pizza\" image={src} /\u003e\n  );\n\n  const img = await screen.getByRole(\"img\");\n\n  await expect.element(img).toBeInTheDocument();\n  await expect.element(img).toHaveAttribute(\"src\", src);\n  await expect.element(img).toHaveAttribute(\"alt\", name);\n});\n```\n\n- `render` will take a React component and render it in a vacuum. You can then poke and prod it as you need to test it.\n- A big part of what Playwright and vitest-browser-react want you to do is not test implementation details but to test actual user experiences. Don't test the internal state of a React component but do test what users will see and experience. As such, a lot of we'll be testing will be around roles, attributes, etc.\n- [@testing-library][principles] has a good doc on why they choose to test this way.\n- In general, vitest-browser-react aims to be a drop in replacement for @testing-library/react.\n\nLooks really similar, right? Alright, let's run it. `npm run test`. You should see the same Vitest UI but now some of the tests are actually running in the browser.\n\n\u003e It will likely prompt you to run a command like `npx playwright install`. You'll install local copies of browsers to able to run them super fast.\n\nCool, right? And really fast! Let's do one more. Let's make a `Header.jsx` test. We're going to test that the cart number is correct. Remember when Facebook notification numbers were always wrong? We're going to make sure that doesn't happen with our cart indicator. In your Header.jsx file:\n\n```javascript\ndata-testid=\"cart-number\" // add to .nav-cart-number\n```\n\nNow make a Header.browser.test.jsx\n\n```javascript\nimport { render } from \"vitest-browser-react\";\nimport { expect, test } from \"vitest\";\nimport Header from \"../Header\";\nimport {\n  RouterProvider,\n  createRouter,\n  createRootRoute,\n} from \"@tanstack/react-router\";\nimport { CartContext } from \"../contexts\";\n\ntest(\"correctly renders a header with a zero cart count\", async () =\u003e {\n  const rootRoute = createRootRoute({\n    component: () =\u003e (\n      \u003cCartContext.Provider value={[[]]}\u003e\n        \u003cHeader /\u003e\n      \u003c/CartContext.Provider\u003e\n    ),\n  });\n\n  const router = createRouter({ routeTree: rootRoute });\n  const screen = render(\u003cRouterProvider router={router}\u003e\u003c/RouterProvider\u003e);\n\n  const itemsInCart = await screen.getByTestId(\"cart-number\");\n\n  await expect.element(itemsInCart).toBeInTheDocument();\n  await expect.element(itemsInCart).toHaveTextContent(\"0\");\n});\n\ntest(\"correctly renders a header with a three cart count\", async () =\u003e {\n  const rootRoute = createRootRoute({\n    component: () =\u003e (\n      \u003cCartContext.Provider\n        value={[[{ pizza: 1 }, { pizza: 2 }, { pizza: 3 }]]}\n      \u003e\n        \u003cHeader /\u003e\n      \u003c/CartContext.Provider\u003e\n    ),\n  });\n\n  const router = createRouter({ routeTree: rootRoute });\n  const screen = render(\u003cRouterProvider router={router}\u003e\u003c/RouterProvider\u003e);\n\n  const itemsInCart = await screen.getByTestId(\"cart-number\");\n\n  await expect.element(itemsInCart).toBeInTheDocument();\n  await expect.element(itemsInCart).toHaveTextContent(\"3\");\n});\n```\n\nWe do have to bend over a bit backwards to make sure TanStack Router is happy, hence all the making of root routes. Remember also that our cart gets its cart from context so we have to pass it in that way. Beyond that, it works very similar!\n\nAgain, these are early days for browser-based testing with Vite so proceed in your professional settings with caution. However the future is bright with Playwright!\n\n\u003e 🚨 NOTE: If you want to add code coverage back into the project, you'll need to use Istanbul since, at the time of this recording, this wasn't supported in React 19 with V8\n\nFirst, you'll need to uninstall V8 and install Istanbul:\n\n```bash\nnpm uninstall @vitest/coverage-v8@2.1.3\nnpm install -D @vitest/istanbul\n```\nThen move the coverage configuration to the `vitest.workspace.js` file:\n\n```javascript\n\nexport default defineWorkspace([\n  {\n    extends: \"./vite.config.js\",\n    test: {\n      // ...\n      // add to the end of the happy-dom test object \n      coverage: {\n        provider: \"istanbul\"\n        reporter: [\"text\", \"json\", \"html\"],\n      },\n    },\n  },\n  {\n    extends: \"./vite.config.js\",\n    test: {\n      // ...\n      // add to the end of the browser test object \n      coverage: {\n        reporter: [\"text\", \"json\", \"html\"],\n      },\n    },\n  },\n]);\n```\n\n\n\n\u003e 🏁 [Click here to see the state of the project up until now: 14-testing][step]\n\n[step]: https://github.com/btholt/citr-v9-project/tree/master/14-testing\n[principles]: https://testing-library.com/docs/guiding-principles\n[playwright]: https://playwright.dev/\n","slug":"browser-tests","title":"Browser Tests","section":"Testing","icon":"vial","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/07-testing/H-browser-tests.md","nextSlug":"/lessons/whats-next/react-19","prevSlug":"/lessons/testing/vitest-ui"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"testing","slug":"browser-tests"},"buildId":"6cfMzZxR9Y4qzeGRDdjZd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>