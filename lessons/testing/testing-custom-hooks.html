<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Testing Custom Hooks – Complete Intro to React</title><meta name="description" content="Learn how to test a custom React hook, usePizzaOfTheDay, by implementing a fake component and utilizing renderHook from testing-library/react. This approach ensures your hooks behave correctly, maintaining code integrity while interacting with APIs, like the example API call for &quot;Pizza of the Day.&quot;"/><meta name="keywords" content="React testing,custom hooks,renderHook,testing-library,API testing"/><meta name="og:description" content="Learn how to test a custom React hook, usePizzaOfTheDay, by implementing a fake component and utilizing renderHook from testing-library/react. This approach ensures your hooks behave correctly, maintaining code integrity while interacting with APIs, like the example API call for &quot;Pizza of the Day.&quot;"/><meta name="og:title" content="Testing Custom Hooks – Complete Intro to React"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2fea0762771cca66.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2fea0762771cca66.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-a6a08e1f60796d6f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8844ca430b4a38f8.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_buildManifest.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React</a></h1><div class="navbar-info"><a href="https://holt.fyi/react" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Let&#39;s say we needs tests for our custom hook, usePizzaOfTheDay. Testing custom hooks is a bit of a trick because they are inherently tied to the internal workings of React: they can&#39;t be called outside of a component. So how we do we get around that? We fake a component! Make a file called <code>usePizzaOfTheDay.test.jsx</code> in our <code>__tests__</code> directory.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { expect, test, vi } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest&quot;</span>;
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@testing-library/react&quot;</span>;
<span class="hljs-keyword">import</span> createFetchMock <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vitest-fetch-mock&quot;</span>;
<span class="hljs-keyword">import</span> { usePizzaOfTheDay } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../usePizzaOfTheDay&quot;</span>;

<span class="hljs-keyword">const</span> fetchMocker = <span class="hljs-title function_">createFetchMock</span>(vi);
fetchMocker.<span class="hljs-title function_">enableMocks</span>();

<span class="hljs-keyword">const</span> testPizza = {
  <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;calabrese&quot;</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;The Calabrese Pizza&quot;</span>,
  <span class="hljs-attr">category</span>: <span class="hljs-string">&quot;Supreme&quot;</span>,
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&quot;Salami, Pancetta, Tomatoes, Red Onions, Friggitello Peppers, Garlic&quot;</span>,
  <span class="hljs-attr">image</span>: <span class="hljs-string">&quot;/public/pizzas/calabrese.webp&quot;</span>,
  <span class="hljs-attr">sizes</span>: { <span class="hljs-attr">S</span>: <span class="hljs-number">12.25</span>, <span class="hljs-attr">M</span>: <span class="hljs-number">16.25</span>, <span class="hljs-attr">L</span>: <span class="hljs-number">20.25</span> },
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPizzaOfTheDay</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">let</span> pizza;

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestComponent</span>(<span class="hljs-params"></span>) {
    pizza = <span class="hljs-title function_">usePizzaOfTheDay</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TestComponent</span> /&gt;</span></span>);

  <span class="hljs-keyword">return</span> pizza;
}

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;gives null when first called&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  fetch.<span class="hljs-title function_">mockResponseOnce</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testPizza));
  <span class="hljs-keyword">const</span> pizza = <span class="hljs-title function_">getPizzaOfTheDay</span>();
  <span class="hljs-title function_">expect</span>(pizza).<span class="hljs-title function_">toBeNull</span>();
});
</code></pre><p>It&#39;s a little weird to implement a fake component to test something (we&#39;re dangerously close to the line of testing implementation details) but this is essentially library code and we want to assure ourselves this code works if we use it frequently in our code base.</p>
<p>We can make this better though. Let&#39;s rewrite our test to look like this:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { renderHook } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@testing-library/react&quot;</span>; <span class="hljs-comment">// change import</span>

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;to be null on initial load&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  fetch.<span class="hljs-title function_">mockResponseOnce</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testPizza));
  <span class="hljs-keyword">const</span> { result } = <span class="hljs-title function_">renderHook</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">usePizzaOfTheDay</span>(<span class="hljs-string">&quot;&quot;</span>));
  <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">current</span>).<span class="hljs-title function_">toBeNull</span>();
});
</code></pre><p>Here the helper <code>renderHook</code> abstracts away that oddity we had to do to get that hook tested. But rest assured it&#39;s doing essentially the same thing: creating a component under the hood that&#39;s running the hook lifecycle methods appropriately for you.</p>
<p>Let&#39;s add a test to make sure it does the right thing with the API response and calls the right API</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { renderHook, waitFor } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@testing-library/react&quot;</span>; <span class="hljs-comment">// add waitFor</span>

<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;to call the API and give back the pizza of the day&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
  fetch.<span class="hljs-title function_">mockResponseOnce</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testPizza));
  <span class="hljs-keyword">const</span> { result } = <span class="hljs-title function_">renderHook</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">usePizzaOfTheDay</span>(<span class="hljs-string">&quot;&quot;</span>));
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">waitFor</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">current</span>).<span class="hljs-title function_">toEqual</span>(testPizza);
  });
  <span class="hljs-title function_">expect</span>(fetchMocker).<span class="hljs-title function_">toBeCalledWith</span>(<span class="hljs-string">&quot;/api/pizza-of-the-day&quot;</span>);
});
</code></pre><ul>
<li>waitFor is a handy trick where you need to wait for React to settle. You give it a body that throws errors until it&#39;s true. <code>expect</code> when it doesn&#39;t work throws an error so that&#39;s how this works.</li>
<li>Once it resolves to true, it passes the test and moves on. If it fails like 20 times (that&#39;s configurable) it will then fail the test.</li>
<li>Some people this is too into the implementation details and I half agree. However it is useful from the perspective that this hook needs to work in a certain way and it has an expectation of an API to call which does affect user behavior so it could be useful. If this was truly our codebase, I&#39;d just test the PizzaOfTheDay component and call it good. But if we used this hook in lots of places, I&#39;d probably a test just for it.</li>
</ul>
</div><div class="lesson-links"><a href="/lessons/testing/testing-user-interaction" class="prev">← Previous</a><a href="/lessons/testing/snapshot-testing" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to test a custom React hook, usePizzaOfTheDay, by implementing a fake component and utilizing renderHook from testing-library/react. This approach ensures your hooks behave correctly, maintaining code integrity while interacting with APIs, like the example API call for \"Pizza of the Day.\"","keywords":["React testing","custom hooks","renderHook","testing-library","API testing"]},"html":"\u003cp\u003eLet\u0026#39;s say we needs tests for our custom hook, usePizzaOfTheDay. Testing custom hooks is a bit of a trick because they are inherently tied to the internal workings of React: they can\u0026#39;t be called outside of a component. So how we do we get around that? We fake a component! Make a file called \u003ccode\u003eusePizzaOfTheDay.test.jsx\u003c/code\u003e in our \u003ccode\u003e__tests__\u003c/code\u003e directory.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { expect, test, vi } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { render } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@testing-library/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e createFetchMock \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vitest-fetch-mock\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { usePizzaOfTheDay } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../usePizzaOfTheDay\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fetchMocker = \u003cspan class=\"hljs-title function_\"\u003ecreateFetchMock\u003c/span\u003e(vi);\nfetchMocker.\u003cspan class=\"hljs-title function_\"\u003eenableMocks\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e testPizza = {\n  \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;calabrese\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;The Calabrese Pizza\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ecategory\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Supreme\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e:\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;Salami, Pancetta, Tomatoes, Red Onions, Friggitello Peppers, Garlic\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eimage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/public/pizzas/calabrese.webp\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003esizes\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eS\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e12.25\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eM\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e16.25\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eL\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20.25\u003c/span\u003e },\n};\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPizzaOfTheDay\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e pizza;\n\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eTestComponent\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    pizza = \u003cspan class=\"hljs-title function_\"\u003eusePizzaOfTheDay\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eTestComponent\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e pizza;\n}\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;gives null when first called\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  fetch.\u003cspan class=\"hljs-title function_\"\u003emockResponseOnce\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(testPizza));\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pizza = \u003cspan class=\"hljs-title function_\"\u003egetPizzaOfTheDay\u003c/span\u003e();\n  \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(pizza).\u003cspan class=\"hljs-title function_\"\u003etoBeNull\u003c/span\u003e();\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIt\u0026#39;s a little weird to implement a fake component to test something (we\u0026#39;re dangerously close to the line of testing implementation details) but this is essentially library code and we want to assure ourselves this code works if we use it frequently in our code base.\u003c/p\u003e\n\u003cp\u003eWe can make this better though. Let\u0026#39;s rewrite our test to look like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderHook } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@testing-library/react\u0026quot;\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// change import\u003c/span\u003e\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;to be null on initial load\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  fetch.\u003cspan class=\"hljs-title function_\"\u003emockResponseOnce\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(testPizza));\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { result } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eusePizzaOfTheDay\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e));\n  \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003etoBeNull\u003c/span\u003e();\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eHere the helper \u003ccode\u003erenderHook\u003c/code\u003e abstracts away that oddity we had to do to get that hook tested. But rest assured it\u0026#39;s doing essentially the same thing: creating a component under the hood that\u0026#39;s running the hook lifecycle methods appropriately for you.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s add a test to make sure it does the right thing with the API response and calls the right API\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderHook, waitFor } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@testing-library/react\u0026quot;\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// add waitFor\u003c/span\u003e\n\n\u003cspan class=\"hljs-title function_\"\u003etest\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;to call the API and give back the pizza of the day\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  fetch.\u003cspan class=\"hljs-title function_\"\u003emockResponseOnce\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(testPizza));\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { result } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eusePizzaOfTheDay\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ewaitFor\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003etoEqual\u003c/span\u003e(testPizza);\n  });\n  \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(fetchMocker).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledWith\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/pizza-of-the-day\u0026quot;\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003ewaitFor is a handy trick where you need to wait for React to settle. You give it a body that throws errors until it\u0026#39;s true. \u003ccode\u003eexpect\u003c/code\u003e when it doesn\u0026#39;t work throws an error so that\u0026#39;s how this works.\u003c/li\u003e\n\u003cli\u003eOnce it resolves to true, it passes the test and moves on. If it fails like 20 times (that\u0026#39;s configurable) it will then fail the test.\u003c/li\u003e\n\u003cli\u003eSome people this is too into the implementation details and I half agree. However it is useful from the perspective that this hook needs to work in a certain way and it has an expectation of an API to call which does affect user behavior so it could be useful. If this was truly our codebase, I\u0026#39;d just test the PizzaOfTheDay component and call it good. But if we used this hook in lots of places, I\u0026#39;d probably a test just for it.\u003c/li\u003e\n\u003c/ul\u003e\n","markdown":"\nLet's say we needs tests for our custom hook, usePizzaOfTheDay. Testing custom hooks is a bit of a trick because they are inherently tied to the internal workings of React: they can't be called outside of a component. So how we do we get around that? We fake a component! Make a file called `usePizzaOfTheDay.test.jsx` in our `__tests__` directory.\n\n```javascript\nimport { expect, test, vi } from \"vitest\";\nimport { render } from \"@testing-library/react\";\nimport createFetchMock from \"vitest-fetch-mock\";\nimport { usePizzaOfTheDay } from \"../usePizzaOfTheDay\";\n\nconst fetchMocker = createFetchMock(vi);\nfetchMocker.enableMocks();\n\nconst testPizza = {\n  id: \"calabrese\",\n  name: \"The Calabrese Pizza\",\n  category: \"Supreme\",\n  description:\n    \"Salami, Pancetta, Tomatoes, Red Onions, Friggitello Peppers, Garlic\",\n  image: \"/public/pizzas/calabrese.webp\",\n  sizes: { S: 12.25, M: 16.25, L: 20.25 },\n};\n\nfunction getPizzaOfTheDay() {\n  let pizza;\n\n  function TestComponent() {\n    pizza = usePizzaOfTheDay();\n    return null;\n  }\n\n  render(\u003cTestComponent /\u003e);\n\n  return pizza;\n}\n\ntest(\"gives null when first called\", async () =\u003e {\n  fetch.mockResponseOnce(JSON.stringify(testPizza));\n  const pizza = getPizzaOfTheDay();\n  expect(pizza).toBeNull();\n});\n```\n\nIt's a little weird to implement a fake component to test something (we're dangerously close to the line of testing implementation details) but this is essentially library code and we want to assure ourselves this code works if we use it frequently in our code base.\n\nWe can make this better though. Let's rewrite our test to look like this:\n\n```javascript\nimport { renderHook } from \"@testing-library/react\"; // change import\n\ntest(\"to be null on initial load\", async () =\u003e {\n  fetch.mockResponseOnce(JSON.stringify(testPizza));\n  const { result } = renderHook(() =\u003e usePizzaOfTheDay(\"\"));\n  expect(result.current).toBeNull();\n});\n```\n\nHere the helper `renderHook` abstracts away that oddity we had to do to get that hook tested. But rest assured it's doing essentially the same thing: creating a component under the hood that's running the hook lifecycle methods appropriately for you.\n\nLet's add a test to make sure it does the right thing with the API response and calls the right API\n\n```javascript\nimport { renderHook, waitFor } from \"@testing-library/react\"; // add waitFor\n\ntest(\"to call the API and give back the pizza of the day\", async () =\u003e {\n  fetch.mockResponseOnce(JSON.stringify(testPizza));\n  const { result } = renderHook(() =\u003e usePizzaOfTheDay(\"\"));\n  await waitFor(() =\u003e {\n    expect(result.current).toEqual(testPizza);\n  });\n  expect(fetchMocker).toBeCalledWith(\"/api/pizza-of-the-day\");\n});\n```\n\n- waitFor is a handy trick where you need to wait for React to settle. You give it a body that throws errors until it's true. `expect` when it doesn't work throws an error so that's how this works.\n- Once it resolves to true, it passes the test and moves on. If it fails like 20 times (that's configurable) it will then fail the test.\n- Some people this is too into the implementation details and I half agree. However it is useful from the perspective that this hook needs to work in a certain way and it has an expectation of an API to call which does affect user behavior so it could be useful. If this was truly our codebase, I'd just test the PizzaOfTheDay component and call it good. But if we used this hook in lots of places, I'd probably a test just for it.\n","slug":"testing-custom-hooks","title":"Testing Custom Hooks","section":"Testing","icon":"vial","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/07-testing/D-testing-custom-hooks.md","nextSlug":"/lessons/testing/snapshot-testing","prevSlug":"/lessons/testing/testing-user-interaction"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"testing","slug":"testing-custom-hooks"},"buildId":"6cfMzZxR9Y4qzeGRDdjZd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>