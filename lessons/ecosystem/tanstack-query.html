<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>TanStack Query ‚Äì Complete Intro to React</title><meta name="description" content="Learn how to create a past orders page in React using TanStack Query to facilitate seamless asynchronous API calls, enhancing code cleanliness and efficiency. This guide by seasoned developer Brian Holt provides detailed instructions on integrating React Query ESLint configurations and leveraging React Query Devtools for better debugging. Ideal for web developers looking to optimize React-based projects with effective data fetching techniques."/><meta name="keywords" content="React,TanStack Query,API calls,web development,JavaScript,Brian Holt"/><meta name="og:description" content="Learn how to create a past orders page in React using TanStack Query to facilitate seamless asynchronous API calls, enhancing code cleanliness and efficiency. This guide by seasoned developer Brian Holt provides detailed instructions on integrating React Query ESLint configurations and leveraging React Query Devtools for better debugging. Ideal for web developers looking to optimize React-based projects with effective data fetching techniques."/><meta name="og:title" content="TanStack Query ‚Äì Complete Intro to React"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2fea0762771cca66.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2fea0762771cca66.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-a6a08e1f60796d6f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8844ca430b4a38f8.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_buildManifest.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React</a></h1><div class="navbar-info"><a href="https://holt.fyi/react" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><h2>Tanstack Query</h2>
<p>Let&#39;s make make a past orders page. Create a new file, <code>past.lazy.jsx</code>. If your Vite server is already running, it will automatically stub it out for you! Pretty cool developer experience from TanStack.</p>
<p>Now let&#39;s install our next tool, <a href="https://tanstack.com/query/latest">TanStack (React) Query</a>.</p>
<pre><code class="hljs language-bash">npm i @tanstack/react-query@5.59.13
npm i -D @tanstack/react-query-devtools@5.59.13 @tanstack/eslint-plugin-query@5.59.7
</code></pre><p>React Query makes doing async API calls so much easier. So much easier / better, that I almost never use <code>useEffect</code> anymore like we did for the pizzas list or for the pizza of the day. The code is cleaner, easier to read, better cached, and less bug prone. In short, it&#39;s just better. It&#39;s good for you to know how to use effects, but as you go forward just use TanStack Query for API calls.</p>
<p>Let&#39;s get started. Let&#39;s start by adding their ESLint config to ours. They have some useful rules in there. In eslint.config.mjs</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// at top</span>
<span class="hljs-keyword">import</span> pluginQuery <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/eslint-plugin-query&quot;</span>;

<span class="hljs-comment">// under reactPlugin.configs.flat[&quot;jsx-runtime&quot;]</span>
...pluginQuery.<span class="hljs-property">configs</span>[<span class="hljs-string">&quot;flat/recommended&quot;</span>],
</code></pre><p>This will add a few rules to your ESLint that are specific to React Query. I have found these helpful, and more importantly, not annoying, so I tend to add them every time.</p>
<p>Let&#39;s also add the dev tools, like we did for the router. In <code>src/routes/__root.jsx</code>:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// at top</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactQueryDevtools</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/react-query-devtools&quot;</span>;

<span class="hljs-comment">// under router dev tools</span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ReactQueryDevtools</span> /&gt;</span></span>
</code></pre><p>Finally, we need to add the <code>QueryClient</code>. In <code>App.jsx</code>, add:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Add imports</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">QueryClient</span>, <span class="hljs-title class_">QueryClientProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/react-query&quot;</span>;

<span class="hljs-comment">// Create a property under the router</span>
<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>()

<span class="hljs-comment">// Add the provider to the app</span>
&lt;<span class="hljs-title class_">QueryClientProvider</span> client={queryClient}&gt;
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{router}</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">QueryClientProvider</span>&gt;
</code></pre><p>Now in the bottom right of your window you&#39;ll see a üèùÔ∏è. Click on that and we&#39;ll open the dev tools. We haven&#39;t used the dev tools yet so it&#39;ll be empty.</p>
<p>So react-query makes interacting with APIs very simple and makes it easy to read. You just read a hook and it&#39;ll either give you a <code>isLoading</code> status or the data. Once the data comes back, it&#39;ll refresh the component with the data. So let&#39;s start by writing our very simple fetch call. Create a folder called <code>api</code> inside of <code>src</code> and create <code>getPastOrders.js</code> and add:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPastOrders</span>(<span class="hljs-params">page</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/past-orders?page=<span class="hljs-subst">${page}</span>`</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">return</span> data;
}
</code></pre><p>Very simple request to an API that returns data. That&#39;s it!</p>
<p>Let&#39;s now go make <code>past.lazy.jsx</code>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> { useQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/react-query&quot;</span>;
<span class="hljs-keyword">import</span> { createLazyFileRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tanstack/react-router&quot;</span>;
<span class="hljs-keyword">import</span> getPastOrders <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../api/getPastOrders&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Route</span> = <span class="hljs-title function_">createLazyFileRoute</span>(<span class="hljs-string">&quot;/past&quot;</span>)({
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">PastOrdersRoute</span>,
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">PastOrdersRoute</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> { isLoading, data } = <span class="hljs-title function_">useQuery</span>({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">&quot;past-orders&quot;</span>, page],
    <span class="hljs-attr">queryFn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getPastOrders</span>(page),
    <span class="hljs-attr">staleTime</span>: <span class="hljs-number">30000</span>,
  });
  <span class="hljs-keyword">if</span> (isLoading) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;past-orders&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>LOADING ‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;past-orders&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Date<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Time<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
          {data.map((order) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{order.order_id}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{order.order_id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{order.date}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{order.time}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;pages&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{page</span> &lt;= <span class="hljs-string">1}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setPage(page - 1)}&gt;
          Previous
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{page}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{data.length</span> &lt; <span class="hljs-attr">10</span>} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setPage(page + 1)}&gt;
          Next
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre><ul>
<li>We&#39;re using hooks to track the page we&#39;re on.</li>
<li>We&#39;re using the useQuery hook to make API calls and we provide it the queryFn of how to go fetch that data.</li>
<li>We&#39;re giving it keys which act as cache keys. We&#39;re giving <code>past-orders</code> as the key but it could be any unique key to this page. Then we give it the page. What&#39;s cool about this is that while we will request the page 1 the first time we request it, the second time we request page 1 it&#39;ll see it&#39;ll see that we already have this in cache and not request it. How cool is is that? That used to require so much logic to handle it and now React Query just does it for you.</li>
<li>Now open the dev tools. You can see all the pages being loaded in. Pretty cool, right?</li>
<li>Try taking out <code>page</code> from the query key. It&#39;ll yell at you. This is the ESLint config we pulled in from Tanstack Query. Because we&#39;re using that <code>page</code> in the request, we need to use it as a caching key. If you depend on a variable to make a request, it should be apart of the caching key.</li>
<li>We&#39;re giving it a <code>staleTime</code> of 30 seconds (30,000 milliseconds). This allows someone using the page to browse around a bit and not bombard the API too much but the page won&#39;t ever be too stale. If you omit <code>staleTime</code>, it will refetch every time.</li>
</ul>
<p>That&#39;s it! React Query is both simple to use and super flexible to handle a tough problem. It&#39;s one of my favorite libraries for React.</p>
<blockquote>
<p>üèÅ <a href="https://github.com/btholt/citr-v9-project/tree/master/10-query">Click here to see the state of the project up until now: 10-query</a></p>
</blockquote>
</div><div class="lesson-links"><a href="/lessons/ecosystem/tanstack-router" class="prev">‚Üê Previous</a><a href="/lessons/advanced-react/portals" class="next">Next ‚Üí</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"TanStack Query","description":"Learn how to create a past orders page in React using TanStack Query to facilitate seamless asynchronous API calls, enhancing code cleanliness and efficiency. This guide by seasoned developer Brian Holt provides detailed instructions on integrating React Query ESLint configurations and leveraging React Query Devtools for better debugging. Ideal for web developers looking to optimize React-based projects with effective data fetching techniques.","keywords":["React","TanStack Query","API calls","web development","JavaScript","Brian Holt"]},"html":"\u003ch2\u003eTanstack Query\u003c/h2\u003e\n\u003cp\u003eLet\u0026#39;s make make a past orders page. Create a new file, \u003ccode\u003epast.lazy.jsx\u003c/code\u003e. If your Vite server is already running, it will automatically stub it out for you! Pretty cool developer experience from TanStack.\u003c/p\u003e\n\u003cp\u003eNow let\u0026#39;s install our next tool, \u003ca href=\"https://tanstack.com/query/latest\"\u003eTanStack (React) Query\u003c/a\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm i @tanstack/react-query@5.59.13\nnpm i -D @tanstack/react-query-devtools@5.59.13 @tanstack/eslint-plugin-query@5.59.7\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eReact Query makes doing async API calls so much easier. So much easier / better, that I almost never use \u003ccode\u003euseEffect\u003c/code\u003e anymore like we did for the pizzas list or for the pizza of the day. The code is cleaner, easier to read, better cached, and less bug prone. In short, it\u0026#39;s just better. It\u0026#39;s good for you to know how to use effects, but as you go forward just use TanStack Query for API calls.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s get started. Let\u0026#39;s start by adding their ESLint config to ours. They have some useful rules in there. In eslint.config.mjs\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pluginQuery \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/eslint-plugin-query\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// under reactPlugin.configs.flat[\u0026quot;jsx-runtime\u0026quot;]\u003c/span\u003e\n...pluginQuery.\u003cspan class=\"hljs-property\"\u003econfigs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\u0026quot;flat/recommended\u0026quot;\u003c/span\u003e],\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will add a few rules to your ESLint that are specific to React Query. I have found these helpful, and more importantly, not annoying, so I tend to add them every time.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s also add the dev tools, like we did for the router. In \u003ccode\u003esrc/routes/__root.jsx\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactQueryDevtools\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/react-query-devtools\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// under router dev tools\u003c/span\u003e\n\u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eReactQueryDevtools\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eFinally, we need to add the \u003ccode\u003eQueryClient\u003c/code\u003e. In \u003ccode\u003eApp.jsx\u003c/code\u003e, add:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Add imports\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eQueryClient\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eQueryClientProvider\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/react-query\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// Create a property under the router\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e queryClient = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eQueryClient\u003c/span\u003e()\n\n\u003cspan class=\"hljs-comment\"\u003e// Add the provider to the app\u003c/span\u003e\n\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eQueryClientProvider\u003c/span\u003e client={queryClient}\u0026gt;\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRouterProvider\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{router}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u0026lt;/\u003cspan class=\"hljs-title class_\"\u003eQueryClientProvider\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow in the bottom right of your window you\u0026#39;ll see a üèùÔ∏è. Click on that and we\u0026#39;ll open the dev tools. We haven\u0026#39;t used the dev tools yet so it\u0026#39;ll be empty.\u003c/p\u003e\n\u003cp\u003eSo react-query makes interacting with APIs very simple and makes it easy to read. You just read a hook and it\u0026#39;ll either give you a \u003ccode\u003eisLoading\u003c/code\u003e status or the data. Once the data comes back, it\u0026#39;ll refresh the component with the data. So let\u0026#39;s start by writing our very simple fetch call. Create a folder called \u003ccode\u003eapi\u003c/code\u003e inside of \u003ccode\u003esrc\u003c/code\u003e and create \u003ccode\u003egetPastOrders.js\u003c/code\u003e and add:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPastOrders\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003epage\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`/api/past-orders?page=\u003cspan class=\"hljs-subst\"\u003e${page}\u003c/span\u003e`\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eVery simple request to an API that returns data. That\u0026#39;s it!\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s now go make \u003ccode\u003epast.lazy.jsx\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useQuery } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/react-query\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createLazyFileRoute } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tanstack/react-router\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e getPastOrders \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../api/getPastOrders\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRoute\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003ecreateLazyFileRoute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/past\u0026quot;\u003c/span\u003e)({\n  \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePastOrdersRoute\u003c/span\u003e,\n});\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ePastOrdersRoute\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [page, setPage] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { isLoading, data } = \u003cspan class=\"hljs-title function_\"\u003euseQuery\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003equeryKey\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;past-orders\u0026quot;\u003c/span\u003e, page],\n    \u003cspan class=\"hljs-attr\"\u003equeryFn\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPastOrders\u003c/span\u003e(page),\n    \u003cspan class=\"hljs-attr\"\u003estaleTime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30000\u003c/span\u003e,\n  });\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isLoading) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;past-orders\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003eLOADING ‚Ä¶\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;past-orders\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etable\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ethead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etr\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003eID\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003eDate\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003eTime\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etr\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ethead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etbody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          {data.map((order) =\u0026gt; (\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etr\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{order.order_id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e{order.order_id}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e{order.date}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e{order.time}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etd\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etr\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          ))}\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etbody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etable\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;pages\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edisabled\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{page\u003c/span\u003e \u0026lt;= \u003cspan class=\"hljs-string\"\u003e1}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u0026gt;\u003c/span\u003e setPage(page - 1)}\u0026gt;\n          Previous\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e{page}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edisabled\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{data.length\u003c/span\u003e \u0026lt; \u003cspan class=\"hljs-attr\"\u003e10\u003c/span\u003e} \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u0026gt;\u003c/span\u003e setPage(page + 1)}\u0026gt;\n          Next\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eWe\u0026#39;re using hooks to track the page we\u0026#39;re on.\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re using the useQuery hook to make API calls and we provide it the queryFn of how to go fetch that data.\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re giving it keys which act as cache keys. We\u0026#39;re giving \u003ccode\u003epast-orders\u003c/code\u003e as the key but it could be any unique key to this page. Then we give it the page. What\u0026#39;s cool about this is that while we will request the page 1 the first time we request it, the second time we request page 1 it\u0026#39;ll see it\u0026#39;ll see that we already have this in cache and not request it. How cool is is that? That used to require so much logic to handle it and now React Query just does it for you.\u003c/li\u003e\n\u003cli\u003eNow open the dev tools. You can see all the pages being loaded in. Pretty cool, right?\u003c/li\u003e\n\u003cli\u003eTry taking out \u003ccode\u003epage\u003c/code\u003e from the query key. It\u0026#39;ll yell at you. This is the ESLint config we pulled in from Tanstack Query. Because we\u0026#39;re using that \u003ccode\u003epage\u003c/code\u003e in the request, we need to use it as a caching key. If you depend on a variable to make a request, it should be apart of the caching key.\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re giving it a \u003ccode\u003estaleTime\u003c/code\u003e of 30 seconds (30,000 milliseconds). This allows someone using the page to browse around a bit and not bombard the API too much but the page won\u0026#39;t ever be too stale. If you omit \u003ccode\u003estaleTime\u003c/code\u003e, it will refetch every time.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThat\u0026#39;s it! React Query is both simple to use and super flexible to handle a tough problem. It\u0026#39;s one of my favorite libraries for React.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eüèÅ \u003ca href=\"https://github.com/btholt/citr-v9-project/tree/master/10-query\"\u003eClick here to see the state of the project up until now: 10-query\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","markdown":"\n## Tanstack Query\n\nLet's make make a past orders page. Create a new file, `past.lazy.jsx`. If your Vite server is already running, it will automatically stub it out for you! Pretty cool developer experience from TanStack.\n\nNow let's install our next tool, [TanStack (React) Query][tsq].\n\n```bash\nnpm i @tanstack/react-query@5.59.13\nnpm i -D @tanstack/react-query-devtools@5.59.13 @tanstack/eslint-plugin-query@5.59.7\n```\n\nReact Query makes doing async API calls so much easier. So much easier / better, that I almost never use `useEffect` anymore like we did for the pizzas list or for the pizza of the day. The code is cleaner, easier to read, better cached, and less bug prone. In short, it's just better. It's good for you to know how to use effects, but as you go forward just use TanStack Query for API calls.\n\nLet's get started. Let's start by adding their ESLint config to ours. They have some useful rules in there. In eslint.config.mjs\n\n```javascript\n// at top\nimport pluginQuery from \"@tanstack/eslint-plugin-query\";\n\n// under reactPlugin.configs.flat[\"jsx-runtime\"]\n...pluginQuery.configs[\"flat/recommended\"],\n```\n\nThis will add a few rules to your ESLint that are specific to React Query. I have found these helpful, and more importantly, not annoying, so I tend to add them every time.\n\nLet's also add the dev tools, like we did for the router. In `src/routes/__root.jsx`:\n\n```javascript\n// at top\nimport { ReactQueryDevtools } from \"@tanstack/react-query-devtools\";\n\n// under router dev tools\n\u003cReactQueryDevtools /\u003e\n```\n\nFinally, we need to add the `QueryClient`. In `App.jsx`, add:\n\n```javascript\n// Add imports\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\n\n// Create a property under the router\nconst queryClient = new QueryClient()\n\n// Add the provider to the app\n\u003cQueryClientProvider client={queryClient}\u003e\n  \u003cRouterProvider router={router} /\u003e\n\u003c/QueryClientProvider\u003e\n```\n\nNow in the bottom right of your window you'll see a üèùÔ∏è. Click on that and we'll open the dev tools. We haven't used the dev tools yet so it'll be empty.\n\nSo react-query makes interacting with APIs very simple and makes it easy to read. You just read a hook and it'll either give you a `isLoading` status or the data. Once the data comes back, it'll refresh the component with the data. So let's start by writing our very simple fetch call. Create a folder called `api` inside of `src` and create `getPastOrders.js` and add:\n\n```javascript\nexport default async function getPastOrders(page) {\n  const response = await fetch(`/api/past-orders?page=${page}`);\n  const data = await response.json();\n  return data;\n}\n```\n\nVery simple request to an API that returns data. That's it!\n\nLet's now go make `past.lazy.jsx`.\n\n```javascript\nimport { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { createLazyFileRoute } from \"@tanstack/react-router\";\nimport getPastOrders from \"../api/getPastOrders\";\n\nexport const Route = createLazyFileRoute(\"/past\")({\n  component: PastOrdersRoute,\n});\n\nfunction PastOrdersRoute() {\n  const [page, setPage] = useState(1);\n  const { isLoading, data } = useQuery({\n    queryKey: [\"past-orders\", page],\n    queryFn: () =\u003e getPastOrders(page),\n    staleTime: 30000,\n  });\n  if (isLoading) {\n    return (\n      \u003cdiv className=\"past-orders\"\u003e\n        \u003ch2\u003eLOADING ‚Ä¶\u003c/h2\u003e\n      \u003c/div\u003e\n    );\n  }\n  return (\n    \u003cdiv className=\"past-orders\"\u003e\n      \u003ctable\u003e\n        \u003cthead\u003e\n          \u003ctr\u003e\n            \u003ctd\u003eID\u003c/td\u003e\n            \u003ctd\u003eDate\u003c/td\u003e\n            \u003ctd\u003eTime\u003c/td\u003e\n          \u003c/tr\u003e\n        \u003c/thead\u003e\n        \u003ctbody\u003e\n          {data.map((order) =\u003e (\n            \u003ctr key={order.order_id}\u003e\n              \u003ctd\u003e{order.order_id}\u003c/td\u003e\n              \u003ctd\u003e{order.date}\u003c/td\u003e\n              \u003ctd\u003e{order.time}\u003c/td\u003e\n            \u003c/tr\u003e\n          ))}\n        \u003c/tbody\u003e\n      \u003c/table\u003e\n      \u003cdiv className=\"pages\"\u003e\n        \u003cbutton disabled={page \u003c= 1} onClick={() =\u003e setPage(page - 1)}\u003e\n          Previous\n        \u003c/button\u003e\n        \u003cdiv\u003e{page}\u003c/div\u003e\n        \u003cbutton disabled={data.length \u003c 10} onClick={() =\u003e setPage(page + 1)}\u003e\n          Next\n        \u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n- We're using hooks to track the page we're on.\n- We're using the useQuery hook to make API calls and we provide it the queryFn of how to go fetch that data.\n- We're giving it keys which act as cache keys. We're giving `past-orders` as the key but it could be any unique key to this page. Then we give it the page. What's cool about this is that while we will request the page 1 the first time we request it, the second time we request page 1 it'll see it'll see that we already have this in cache and not request it. How cool is is that? That used to require so much logic to handle it and now React Query just does it for you.\n- Now open the dev tools. You can see all the pages being loaded in. Pretty cool, right?\n- Try taking out `page` from the query key. It'll yell at you. This is the ESLint config we pulled in from Tanstack Query. Because we're using that `page` in the request, we need to use it as a caching key. If you depend on a variable to make a request, it should be apart of the caching key.\n- We're giving it a `staleTime` of 30 seconds (30,000 milliseconds). This allows someone using the page to browse around a bit and not bombard the API too much but the page won't ever be too stale. If you omit `staleTime`, it will refetch every time.\n\nThat's it! React Query is both simple to use and super flexible to handle a tough problem. It's one of my favorite libraries for React.\n\n\u003e üèÅ [Click here to see the state of the project up until now: 10-query][step]\n\n[step]: https://github.com/btholt/citr-v9-project/tree/master/10-query\n[tsq]: https://tanstack.com/query/latest\n","slug":"tanstack-query","title":"TanStack Query","section":"Ecosystem","icon":"seedling","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/05-ecosystem/B-tanstack-query.md","nextSlug":"/lessons/advanced-react/portals","prevSlug":"/lessons/ecosystem/tanstack-router"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"ecosystem","slug":"tanstack-query"},"buildId":"6cfMzZxR9Y4qzeGRDdjZd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>