<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Effects ‚Äì Complete Intro to React</title><meta name="description" content="In this section of the Complete Intro to React v9 course by Brian Holt, learn how to use the `useEffect` hook to make API requests for initializing a list of pizzas, manage UI initial load with loading states, and optimize component updates using unique keys for rendering efficiency. Enhance your React projects with best practices for asynchronous data fetching and component optimization."/><meta name="keywords" content="React useEffect,API requests,React loading state,React component optimization,Brian Holt"/><meta name="og:description" content="In this section of the Complete Intro to React v9 course by Brian Holt, learn how to use the `useEffect` hook to make API requests for initializing a list of pizzas, manage UI initial load with loading states, and optimize component updates using unique keys for rendering efficiency. Enhance your React projects with best practices for asynchronous data fetching and component optimization."/><meta name="og:title" content="Effects ‚Äì Complete Intro to React"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2fea0762771cca66.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2fea0762771cca66.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-a6a08e1f60796d6f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8844ca430b4a38f8.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_buildManifest.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React</a></h1><div class="navbar-info"><a href="https://holt.fyi/react" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><h2>Effects</h2>
<p>We have enough of an app to start making some API requests now. We want the app to request an initial set of pizzaTypes on initial load of the page. So let&#39;s make that happen using a special hook called <code>useEffect</code>. <code>useEffect</code> allows you to say do a render of this component first so the user can see <em>something</em> then as soon as the render is done, <em>then</em> do something (the something here being an effect). In our case, we want the user to see our UI first then we want to make a request to the API so we can initialize a list of pizzas.</p>
<blockquote>
<p>Make sure you have both your Vite dev server running <em>and</em> your API server running. Both.</p>
</blockquote>
<p>Let&#39;s refactor Order.jsx</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// change import at top</span>
<span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Pizza</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Pizza&quot;</span>;

<span class="hljs-comment">// outside of the render function</span>
<span class="hljs-comment">// feel free to change en-US / USD to your locale</span>
<span class="hljs-keyword">const</span> intl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>, {
  <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>,
  <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
});

<span class="hljs-comment">// add to the other useStates inside component at top</span>
<span class="hljs-keyword">const</span> [pizzaTypes, setPizzaTypes] = <span class="hljs-title function_">useState</span>([]);
<span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);

<span class="hljs-keyword">let</span> price, selectedPizza;
<span class="hljs-keyword">if</span> (!loading) {
  selectedPizza = pizzaTypes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">pizza</span>) =&gt;</span> pizzaType === pizza.<span class="hljs-property">id</span>);
  price = intl.<span class="hljs-title function_">format</span>(
    selectedPizza.<span class="hljs-property">sizes</span> ? selectedPizza.<span class="hljs-property">sizes</span>[pizzaSize] : <span class="hljs-string">&quot;&quot;</span>
  );
}

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchPizzaTypes</span>();
}, []);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPizzaTypes</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">3000</span>)); <span class="hljs-comment">// remove this later, just to show you the loading state</span>

  <span class="hljs-keyword">const</span> pizzasRes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/pizzas&quot;</span>);
  <span class="hljs-keyword">const</span> pizzasJson = <span class="hljs-keyword">await</span> pizzasRes.<span class="hljs-title function_">json</span>();
  <span class="hljs-title function_">setPizzaTypes</span>(pizzasJson);
  <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
}

<span class="hljs-comment">// replace the options</span>
{
  pizzaTypes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">pizza</span>) =&gt;</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{pizza.id}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{pizza.id}</span>&gt;</span>
      {pizza.name}
    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span>
  ));
}

<span class="hljs-comment">// replace &lt;Pizza /&gt; and button at the end</span>
</code></pre><ul>
<li>We put all the logic for fetching pizza types in an async function to make it more readable. You can&#39;t make the function provided to useEffect async.</li>
<li>the <code>[]</code> at the end of the useEffect is where you declare your data dependencies. React wants to know <em>when</em> to run that effect again. You don&#39;t give it data dependencies, it assumes any time any hook changes that you should run the effect again. This is bad because that would mean any time setPizzaTypes gets called it&#39;d re-run render and all the hooks again. See a problem there? It&#39;d run infinitely since fetchPizzaTypes calls setPizzaTypes.</li>
<li>You can instead provide which hooks to watch for changes for. In our case, we actually only want it to run once, on creation of the component, and then to not run that effect again. (we&#39;ll do searching later via clicking the submit button) You can accomplish this only-run-on-creation by providing an empty array.</li>
<li>We&#39;re using a loading flag to only display data once it&#39;s ready. We&#39;ll use TanStack Query in a bit to make this code look cleaner. But this is how you do conditional showing/hiding of components in React.</li>
<li>The <code>key</code> portion is an interesting one. When React renders arrays of things, it doesn&#39;t know the difference between something is new and something is just being re-ordered in the array (think like changing the sorting of a results list, like price high-to-low and then priced low-to-high). Because of this, if you don&#39;t tell React how to handle those situations, it just tears it all down and re-renders everything anew. This can cause unnecessary slowness on devices. This is what key is for. Key tells React &quot;this is a simple identifier of what this component is&quot;. If React sees you just moved a key to a different order, it will keep the component tree. So key here is to associate the key to something unique about that component. 99/100 this is a database ID of some variety. <em>Don&#39;t</em> use the index of the array as that just isn&#39;t right unless the array is literally is never going to change order.</li>
</ul>
<h3>Updating the Selected Pizza &amp; Price</h3>
<p>When a pizza is selected, we need to update the selected pizza and price. First, let&#39;s format the price after the <code>selectedPizza</code> state is updated:</p>
<pre><code class="hljs language-javascript">  <span class="hljs-keyword">if</span>(!loading){
    selectedPizza = pizzaTypes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">pizza</span>) =&gt;</span> pizzaType === pizza.<span class="hljs-property">id</span>)
    price = intl.<span class="hljs-title function_">format</span>(selectedPizza.<span class="hljs-property">sizes</span>[pizzaSize])
  }
</code></pre><p>When the application loads, we don&#39;t have our data yet. So we only want to render a selected pizza and price once we are done loading. Add a condition to the JSX to show &quot;Loading...&quot; initially, and then the selected pizza once we are done loading. Add the condition <strong>before</strong> the closing <code>&lt;/form&gt;</code> tag:</p>
<pre><code class="hljs language-jsx">...
  {
    loading ? (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>
    ) : (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;order-pizza&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Pizza</span>
          <span class="hljs-attr">name</span>=<span class="hljs-string">{selectedPizza.name}</span>
          <span class="hljs-attr">description</span>=<span class="hljs-string">{selectedPizza.description}</span>
          <span class="hljs-attr">image</span>=<span class="hljs-string">{selectedPizza.image}</span>
        /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{price}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
&lt;/form&gt;
</code></pre><blockquote>
<p>üèÅ <a href="https://github.com/btholt/citr-v9-project/tree/master/05-effects">Click here to see the state of the project up until now: 05-effects</a></p>
</blockquote>
</div><div class="lesson-links"><a href="/lessons/core-react-concepts/hooks" class="prev">‚Üê Previous</a><a href="/lessons/core-react-concepts/dev-tools" class="next">Next ‚Üí</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"In this section of the Complete Intro to React v9 course by Brian Holt, learn how to use the `useEffect` hook to make API requests for initializing a list of pizzas, manage UI initial load with loading states, and optimize component updates using unique keys for rendering efficiency. Enhance your React projects with best practices for asynchronous data fetching and component optimization.","keywords":["React useEffect","API requests","React loading state","React component optimization","Brian Holt"]},"html":"\u003ch2\u003eEffects\u003c/h2\u003e\n\u003cp\u003eWe have enough of an app to start making some API requests now. We want the app to request an initial set of pizzaTypes on initial load of the page. So let\u0026#39;s make that happen using a special hook called \u003ccode\u003euseEffect\u003c/code\u003e. \u003ccode\u003euseEffect\u003c/code\u003e allows you to say do a render of this component first so the user can see \u003cem\u003esomething\u003c/em\u003e then as soon as the render is done, \u003cem\u003ethen\u003c/em\u003e do something (the something here being an effect). In our case, we want the user to see our UI first then we want to make a request to the API so we can initialize a list of pizzas.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMake sure you have both your Vite dev server running \u003cem\u003eand\u003c/em\u003e your API server running. Both.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLet\u0026#39;s refactor Order.jsx\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// change import at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useEffect, useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePizza\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./Pizza\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// outside of the render function\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// feel free to change en-US / USD to your locale\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e intl = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIntl\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eNumberFormat\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;en-US\u0026quot;\u003c/span\u003e, {\n  \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;currency\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ecurrency\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;USD\u0026quot;\u003c/span\u003e,\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// add to the other useStates inside component at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [pizzaTypes, setPizzaTypes] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e([]);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [loading, setLoading] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e price, selectedPizza;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!loading) {\n  selectedPizza = pizzaTypes.\u003cspan class=\"hljs-title function_\"\u003efind\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epizza\u003c/span\u003e) =\u0026gt;\u003c/span\u003e pizzaType === pizza.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e);\n  price = intl.\u003cspan class=\"hljs-title function_\"\u003eformat\u003c/span\u003e(\n    selectedPizza.\u003cspan class=\"hljs-property\"\u003esizes\u003c/span\u003e ? selectedPizza.\u003cspan class=\"hljs-property\"\u003esizes\u003c/span\u003e[pizzaSize] : \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003efetchPizzaTypes\u003c/span\u003e();\n}, []);\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchPizzaTypes\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(resolve, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// remove this later, just to show you the loading state\u003c/span\u003e\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pizzasRes = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/pizzas\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pizzasJson = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e pizzasRes.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e();\n  \u003cspan class=\"hljs-title function_\"\u003esetPizzaTypes\u003c/span\u003e(pizzasJson);\n  \u003cspan class=\"hljs-title function_\"\u003esetLoading\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// replace the options\u003c/span\u003e\n{\n  pizzaTypes.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epizza\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{pizza.id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{pizza.id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      {pizza.name}\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  ));\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// replace \u0026lt;Pizza /\u0026gt; and button at the end\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eWe put all the logic for fetching pizza types in an async function to make it more readable. You can\u0026#39;t make the function provided to useEffect async.\u003c/li\u003e\n\u003cli\u003ethe \u003ccode\u003e[]\u003c/code\u003e at the end of the useEffect is where you declare your data dependencies. React wants to know \u003cem\u003ewhen\u003c/em\u003e to run that effect again. You don\u0026#39;t give it data dependencies, it assumes any time any hook changes that you should run the effect again. This is bad because that would mean any time setPizzaTypes gets called it\u0026#39;d re-run render and all the hooks again. See a problem there? It\u0026#39;d run infinitely since fetchPizzaTypes calls setPizzaTypes.\u003c/li\u003e\n\u003cli\u003eYou can instead provide which hooks to watch for changes for. In our case, we actually only want it to run once, on creation of the component, and then to not run that effect again. (we\u0026#39;ll do searching later via clicking the submit button) You can accomplish this only-run-on-creation by providing an empty array.\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re using a loading flag to only display data once it\u0026#39;s ready. We\u0026#39;ll use TanStack Query in a bit to make this code look cleaner. But this is how you do conditional showing/hiding of components in React.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003ekey\u003c/code\u003e portion is an interesting one. When React renders arrays of things, it doesn\u0026#39;t know the difference between something is new and something is just being re-ordered in the array (think like changing the sorting of a results list, like price high-to-low and then priced low-to-high). Because of this, if you don\u0026#39;t tell React how to handle those situations, it just tears it all down and re-renders everything anew. This can cause unnecessary slowness on devices. This is what key is for. Key tells React \u0026quot;this is a simple identifier of what this component is\u0026quot;. If React sees you just moved a key to a different order, it will keep the component tree. So key here is to associate the key to something unique about that component. 99/100 this is a database ID of some variety. \u003cem\u003eDon\u0026#39;t\u003c/em\u003e use the index of the array as that just isn\u0026#39;t right unless the array is literally is never going to change order.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eUpdating the Selected Pizza \u0026amp; Price\u003c/h3\u003e\n\u003cp\u003eWhen a pizza is selected, we need to update the selected pizza and price. First, let\u0026#39;s format the price after the \u003ccode\u003eselectedPizza\u003c/code\u003e state is updated:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!loading){\n    selectedPizza = pizzaTypes.\u003cspan class=\"hljs-title function_\"\u003efind\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epizza\u003c/span\u003e) =\u0026gt;\u003c/span\u003e pizzaType === pizza.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e)\n    price = intl.\u003cspan class=\"hljs-title function_\"\u003eformat\u003c/span\u003e(selectedPizza.\u003cspan class=\"hljs-property\"\u003esizes\u003c/span\u003e[pizzaSize])\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWhen the application loads, we don\u0026#39;t have our data yet. So we only want to render a selected pizza and price once we are done loading. Add a condition to the JSX to show \u0026quot;Loading...\u0026quot; initially, and then the selected pizza once we are done loading. Add the condition \u003cstrong\u003ebefore\u003c/strong\u003e the closing \u003ccode\u003e\u0026lt;/form\u0026gt;\u003c/code\u003e tag:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e...\n  {\n    loading ? (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh3\u003c/span\u003e\u0026gt;\u003c/span\u003eLoading...\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh3\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    ) : (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;order-pizza\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ePizza\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{selectedPizza.name}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{selectedPizza.description}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eimage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{selectedPizza.image}\u003c/span\u003e\n        /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e{price}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    )\n  }\n\u0026lt;/form\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eüèÅ \u003ca href=\"https://github.com/btholt/citr-v9-project/tree/master/05-effects\"\u003eClick here to see the state of the project up until now: 05-effects\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","markdown":"\n## Effects\n\nWe have enough of an app to start making some API requests now. We want the app to request an initial set of pizzaTypes on initial load of the page. So let's make that happen using a special hook called `useEffect`. `useEffect` allows you to say do a render of this component first so the user can see _something_ then as soon as the render is done, _then_ do something (the something here being an effect). In our case, we want the user to see our UI first then we want to make a request to the API so we can initialize a list of pizzas.\n\n\u003e Make sure you have both your Vite dev server running _and_ your API server running. Both.\n\nLet's refactor Order.jsx\n\n```javascript\n// change import at top\nimport { useEffect, useState } from \"react\";\nimport Pizza from \"./Pizza\";\n\n// outside of the render function\n// feel free to change en-US / USD to your locale\nconst intl = new Intl.NumberFormat(\"en-US\", {\n  style: \"currency\",\n  currency: \"USD\",\n});\n\n// add to the other useStates inside component at top\nconst [pizzaTypes, setPizzaTypes] = useState([]);\nconst [loading, setLoading] = useState(true);\n\nlet price, selectedPizza;\nif (!loading) {\n  selectedPizza = pizzaTypes.find((pizza) =\u003e pizzaType === pizza.id);\n  price = intl.format(\n    selectedPizza.sizes ? selectedPizza.sizes[pizzaSize] : \"\"\n  );\n}\n\nuseEffect(() =\u003e {\n  fetchPizzaTypes();\n}, []);\n\nasync function fetchPizzaTypes() {\n  await new Promise((resolve) =\u003e setTimeout(resolve, 3000)); // remove this later, just to show you the loading state\n\n  const pizzasRes = await fetch(\"/api/pizzas\");\n  const pizzasJson = await pizzasRes.json();\n  setPizzaTypes(pizzasJson);\n  setLoading(false);\n}\n\n// replace the options\n{\n  pizzaTypes.map((pizza) =\u003e (\n    \u003coption key={pizza.id} value={pizza.id}\u003e\n      {pizza.name}\n    \u003c/option\u003e\n  ));\n}\n\n// replace \u003cPizza /\u003e and button at the end\n```\n\n- We put all the logic for fetching pizza types in an async function to make it more readable. You can't make the function provided to useEffect async.\n- the `[]` at the end of the useEffect is where you declare your data dependencies. React wants to know _when_ to run that effect again. You don't give it data dependencies, it assumes any time any hook changes that you should run the effect again. This is bad because that would mean any time setPizzaTypes gets called it'd re-run render and all the hooks again. See a problem there? It'd run infinitely since fetchPizzaTypes calls setPizzaTypes.\n- You can instead provide which hooks to watch for changes for. In our case, we actually only want it to run once, on creation of the component, and then to not run that effect again. (we'll do searching later via clicking the submit button) You can accomplish this only-run-on-creation by providing an empty array.\n- We're using a loading flag to only display data once it's ready. We'll use TanStack Query in a bit to make this code look cleaner. But this is how you do conditional showing/hiding of components in React.\n- The `key` portion is an interesting one. When React renders arrays of things, it doesn't know the difference between something is new and something is just being re-ordered in the array (think like changing the sorting of a results list, like price high-to-low and then priced low-to-high). Because of this, if you don't tell React how to handle those situations, it just tears it all down and re-renders everything anew. This can cause unnecessary slowness on devices. This is what key is for. Key tells React \"this is a simple identifier of what this component is\". If React sees you just moved a key to a different order, it will keep the component tree. So key here is to associate the key to something unique about that component. 99/100 this is a database ID of some variety. _Don't_ use the index of the array as that just isn't right unless the array is literally is never going to change order.\n\n### Updating the Selected Pizza \u0026 Price\n\nWhen a pizza is selected, we need to update the selected pizza and price. First, let's format the price after the `selectedPizza` state is updated:\n\n```javascript\n  if(!loading){\n    selectedPizza = pizzaTypes.find((pizza) =\u003e pizzaType === pizza.id)\n    price = intl.format(selectedPizza.sizes[pizzaSize])\n  }\n```\n\nWhen the application loads, we don't have our data yet. So we only want to render a selected pizza and price once we are done loading. Add a condition to the JSX to show \"Loading...\" initially, and then the selected pizza once we are done loading. Add the condition **before** the closing `\u003c/form\u003e` tag:\n\n```jsx\n...\n  {\n    loading ? (\n      \u003ch3\u003eLoading...\u003c/h3\u003e\n    ) : (\n      \u003cdiv className=\"order-pizza\"\u003e\n        \u003cPizza\n          name={selectedPizza.name}\n          description={selectedPizza.description}\n          image={selectedPizza.image}\n        /\u003e\n        \u003cp\u003e{price}\u003c/p\u003e\n      \u003c/div\u003e\n    )\n  }\n\u003c/form\u003e\n```\n\n\u003e üèÅ [Click here to see the state of the project up until now: 05-effects][step]\n\n[step]: https://github.com/btholt/citr-v9-project/tree/master/05-effects\n","slug":"effects","title":"Effects","section":"Core React Concepts","icon":"book","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/04-core-react-concepts/C-effects.md","nextSlug":"/lessons/core-react-concepts/dev-tools","prevSlug":"/lessons/core-react-concepts/hooks"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"core-react-concepts","slug":"effects"},"buildId":"6cfMzZxR9Y4qzeGRDdjZd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>