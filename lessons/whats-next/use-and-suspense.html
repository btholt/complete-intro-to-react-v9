<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>use and Suspense ‚Äì Complete Intro to React</title><meta name="description" content="Explore React Suspense and the new &#x27;use&#x27; hook in React 19, alongside TanStack Query integration, to manage component rendering and data loading seamlessly. Learn how to implement Suspense to improve code readability and handling of async operations in React applications, guided by seasoned developer Brian Holt."/><meta name="keywords" content="React Suspense,use hook,TanStack Query,React 19,async rendering"/><meta name="og:description" content="Explore React Suspense and the new &#x27;use&#x27; hook in React 19, alongside TanStack Query integration, to manage component rendering and data loading seamlessly. Learn how to implement Suspense to improve code readability and handling of async operations in React applications, guided by seasoned developer Brian Holt."/><meta name="og:title" content="use and Suspense ‚Äì Complete Intro to React"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2fea0762771cca66.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2fea0762771cca66.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-a6a08e1f60796d6f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8844ca430b4a38f8.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_buildManifest.js" defer=""></script><script src="/_next/static/6cfMzZxR9Y4qzeGRDdjZd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React</a></h1><div class="navbar-info"><a href="https://holt.fyi/react" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><h2>use and Suspense</h2>
<p>We&#39;ve been talking about React Suspense for a long time, and technically still we are not suppose to use it directly. But we React 19 we will get some blessed ways to start using it. (Some libraries already use it.)</p>
<p>The idea behind Suspense is that a React component can start rendering and then suspend itself if all its data hasn&#39;t loaded yet. This is cool because your code reads really well: it basically looks like you&#39;re assuming the data is already there, and React takes care of getting it behind the scene.</p>
<p>This is what the idea of the new <code>use</code> hook is from React. You say <code>use(myPromise)</code> and the React component will only render once myPromise has rendered.</p>
<p>Luckily TanStack Query already has a few ways of doing this, so we&#39;re going to use that. But just know that <code>use</code> works with any promise, not just TanStack Query.</p>
<p>First open App.jsx, we have to enable the experimental support for this in TanStack Query (you may not need to this in the future.)</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// replace queryClient</span>
<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>({
  <span class="hljs-attr">defaultOptions</span>: {
    <span class="hljs-attr">queries</span>: {
      <span class="hljs-attr">experimental_prefetchInRender</span>: <span class="hljs-literal">true</span>,
    },
  },
});
</code></pre><p>Now in past.lazy.jsx, we need to do some refactoring.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span>, useState, use } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>; <span class="hljs-comment">// import Suspense and use</span>

<span class="hljs-comment">// move query and page hooks to ErrorBoundary component</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ErrorBoundaryWrappedPastOrderRoutes</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> loadedPromise = <span class="hljs-title function_">useQuery</span>({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">&quot;past-orders&quot;</span>, page],
    <span class="hljs-attr">queryFn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getPastOrders</span>(page),
    <span class="hljs-attr">staleTime</span>: <span class="hljs-number">30000</span>,
  }).<span class="hljs-property">promise</span>;
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>
        <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>
          &lt;<span class="hljs-attr">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;past-orders&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Loading Past Orders ‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        }
      &gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">PastOrdersRoute</span>
          <span class="hljs-attr">loadedPromise</span>=<span class="hljs-string">{loadedPromise}</span>
          <span class="hljs-attr">page</span>=<span class="hljs-string">{page}</span>
          <span class="hljs-attr">setPage</span>=<span class="hljs-string">{setPage}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// first line in PastOrderRoute</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">use</span>(loadedPromise);
<span class="hljs-comment">// also, we had to remove the useQuery call to getPastOrders (with an S), and the related if (isLoading) return statement</span>
</code></pre><ul>
<li>We use Suspense to tell React where to pause rendering until <em>everything</em> in it has resolved. If you have several things that suspend, this won&#39;t render until they all complete.</li>
<li>fallback tells it what to render while it&#39;s suspended</li>
<li>We need to query inside the parent component (and thus keep track of the page too) because the promise needs to exist outside of the component that is getting suspended. Otherwise it&#39;d be freshly called every single your component rendered. Similar to error boundaries.</li>
<li>We shoved everything in our error boundary wrapping component. This should probably be renamed.</li>
<li>Again, we&#39;re using TanStack Query&#39;s support for this, but it could be any promise. TanStack Query just made it easy.</li>
<li>TanStack Query <a href="https://tanstack.com/query/v5/docs/framework/react/guides/suspense">has several other ways of doing Suspense</a>. We just wanted to try the <code>use</code> hook.</li>
<li><a href="https://react.dev/reference/react/use">use</a> has a few other uses. Check it out in the docs.</li>
<li>Unlike most hooks, use, can be used in conditionals and for loops. Kinda weird given most of the rules around hooks, but still true.</li>
</ul>
<blockquote>
<p>üèÅ <a href="https://github.com/btholt/citr-v9-project/tree/master/16-use">Click here to see the state of the project up until now: 16-use</a></p>
</blockquote>
</div><div class="lesson-links"><a href="/lessons/whats-next/form-actions" class="prev">‚Üê Previous</a><a href="/lessons/whats-next/react-compiler" class="next">Next ‚Üí</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"use and Suspense","description":"Explore React Suspense and the new 'use' hook in React 19, alongside TanStack Query integration, to manage component rendering and data loading seamlessly. Learn how to implement Suspense to improve code readability and handling of async operations in React applications, guided by seasoned developer Brian Holt.","keywords":["React Suspense","use hook","TanStack Query","React 19","async rendering"]},"html":"\u003ch2\u003euse and Suspense\u003c/h2\u003e\n\u003cp\u003eWe\u0026#39;ve been talking about React Suspense for a long time, and technically still we are not suppose to use it directly. But we React 19 we will get some blessed ways to start using it. (Some libraries already use it.)\u003c/p\u003e\n\u003cp\u003eThe idea behind Suspense is that a React component can start rendering and then suspend itself if all its data hasn\u0026#39;t loaded yet. This is cool because your code reads really well: it basically looks like you\u0026#39;re assuming the data is already there, and React takes care of getting it behind the scene.\u003c/p\u003e\n\u003cp\u003eThis is what the idea of the new \u003ccode\u003euse\u003c/code\u003e hook is from React. You say \u003ccode\u003euse(myPromise)\u003c/code\u003e and the React component will only render once myPromise has rendered.\u003c/p\u003e\n\u003cp\u003eLuckily TanStack Query already has a few ways of doing this, so we\u0026#39;re going to use that. But just know that \u003ccode\u003euse\u003c/code\u003e works with any promise, not just TanStack Query.\u003c/p\u003e\n\u003cp\u003eFirst open App.jsx, we have to enable the experimental support for this in TanStack Query (you may not need to this in the future.)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// replace queryClient\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e queryClient = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eQueryClient\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003edefaultOptions\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003equeries\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003eexperimental_prefetchInRender\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    },\n  },\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow in past.lazy.jsx, we need to do some refactoring.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eSuspense\u003c/span\u003e, useState, use } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// import Suspense and use\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// move query and page hooks to ErrorBoundary component\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eErrorBoundaryWrappedPastOrderRoutes\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [page, setPage] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e loadedPromise = \u003cspan class=\"hljs-title function_\"\u003euseQuery\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003equeryKey\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;past-orders\u0026quot;\u003c/span\u003e, page],\n    \u003cspan class=\"hljs-attr\"\u003equeryFn\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPastOrders\u003c/span\u003e(page),\n    \u003cspan class=\"hljs-attr\"\u003estaleTime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30000\u003c/span\u003e,\n  }).\u003cspan class=\"hljs-property\"\u003epromise\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eErrorBoundary\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eSuspense\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003efallback\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\n          \u0026lt;\u003cspan class=\"hljs-attr\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;past-orders\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003eLoading Past Orders ‚Ä¶\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        }\n      \u0026gt;\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ePastOrdersRoute\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eloadedPromise\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{loadedPromise}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003epage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{page}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003esetPage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{setPage}\u003c/span\u003e\n        /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eSuspense\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eErrorBoundary\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// first line in PastOrderRoute\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(loadedPromise);\n\u003cspan class=\"hljs-comment\"\u003e// also, we had to remove the useQuery call to getPastOrders (with an S), and the related if (isLoading) return statement\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eWe use Suspense to tell React where to pause rendering until \u003cem\u003eeverything\u003c/em\u003e in it has resolved. If you have several things that suspend, this won\u0026#39;t render until they all complete.\u003c/li\u003e\n\u003cli\u003efallback tells it what to render while it\u0026#39;s suspended\u003c/li\u003e\n\u003cli\u003eWe need to query inside the parent component (and thus keep track of the page too) because the promise needs to exist outside of the component that is getting suspended. Otherwise it\u0026#39;d be freshly called every single your component rendered. Similar to error boundaries.\u003c/li\u003e\n\u003cli\u003eWe shoved everything in our error boundary wrapping component. This should probably be renamed.\u003c/li\u003e\n\u003cli\u003eAgain, we\u0026#39;re using TanStack Query\u0026#39;s support for this, but it could be any promise. TanStack Query just made it easy.\u003c/li\u003e\n\u003cli\u003eTanStack Query \u003ca href=\"https://tanstack.com/query/v5/docs/framework/react/guides/suspense\"\u003ehas several other ways of doing Suspense\u003c/a\u003e. We just wanted to try the \u003ccode\u003euse\u003c/code\u003e hook.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://react.dev/reference/react/use\"\u003euse\u003c/a\u003e has a few other uses. Check it out in the docs.\u003c/li\u003e\n\u003cli\u003eUnlike most hooks, use, can be used in conditionals and for loops. Kinda weird given most of the rules around hooks, but still true.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eüèÅ \u003ca href=\"https://github.com/btholt/citr-v9-project/tree/master/16-use\"\u003eClick here to see the state of the project up until now: 16-use\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","markdown":"\n## use and Suspense\n\nWe've been talking about React Suspense for a long time, and technically still we are not suppose to use it directly. But we React 19 we will get some blessed ways to start using it. (Some libraries already use it.)\n\nThe idea behind Suspense is that a React component can start rendering and then suspend itself if all its data hasn't loaded yet. This is cool because your code reads really well: it basically looks like you're assuming the data is already there, and React takes care of getting it behind the scene.\n\nThis is what the idea of the new `use` hook is from React. You say `use(myPromise)` and the React component will only render once myPromise has rendered.\n\nLuckily TanStack Query already has a few ways of doing this, so we're going to use that. But just know that `use` works with any promise, not just TanStack Query.\n\nFirst open App.jsx, we have to enable the experimental support for this in TanStack Query (you may not need to this in the future.)\n\n```javascript\n// replace queryClient\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      experimental_prefetchInRender: true,\n    },\n  },\n});\n```\n\nNow in past.lazy.jsx, we need to do some refactoring.\n\n```javascript\nimport { Suspense, useState, use } from \"react\"; // import Suspense and use\n\n// move query and page hooks to ErrorBoundary component\nfunction ErrorBoundaryWrappedPastOrderRoutes() {\n  const [page, setPage] = useState(1);\n  const loadedPromise = useQuery({\n    queryKey: [\"past-orders\", page],\n    queryFn: () =\u003e getPastOrders(page),\n    staleTime: 30000,\n  }).promise;\n  return (\n    \u003cErrorBoundary\u003e\n      \u003cSuspense\n        fallback={\n          \u003cdiv className=\"past-orders\"\u003e\n            \u003ch2\u003eLoading Past Orders ‚Ä¶\u003c/h2\u003e\n          \u003c/div\u003e\n        }\n      \u003e\n        \u003cPastOrdersRoute\n          loadedPromise={loadedPromise}\n          page={page}\n          setPage={setPage}\n        /\u003e\n      \u003c/Suspense\u003e\n    \u003c/ErrorBoundary\u003e\n  );\n}\n\n// first line in PastOrderRoute\nconst data = use(loadedPromise);\n// also, we had to remove the useQuery call to getPastOrders (with an S), and the related if (isLoading) return statement\n```\n\n- We use Suspense to tell React where to pause rendering until _everything_ in it has resolved. If you have several things that suspend, this won't render until they all complete.\n- fallback tells it what to render while it's suspended\n- We need to query inside the parent component (and thus keep track of the page too) because the promise needs to exist outside of the component that is getting suspended. Otherwise it'd be freshly called every single your component rendered. Similar to error boundaries.\n- We shoved everything in our error boundary wrapping component. This should probably be renamed.\n- Again, we're using TanStack Query's support for this, but it could be any promise. TanStack Query just made it easy.\n- TanStack Query [has several other ways of doing Suspense][tsq-suspense]. We just wanted to try the `use` hook.\n- [use][use] has a few other uses. Check it out in the docs.\n- Unlike most hooks, use, can be used in conditionals and for loops. Kinda weird given most of the rules around hooks, but still true.\n\n\u003e üèÅ [Click here to see the state of the project up until now: 16-use][step]\n\n[step]: https://github.com/btholt/citr-v9-project/tree/master/16-use\n[tsq-suspense]: https://tanstack.com/query/v5/docs/framework/react/guides/suspense\n[use]: https://react.dev/reference/react/use\n","slug":"use-and-suspense","title":"use and Suspense","section":"Whats Next","icon":"shuttle-space","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/08-whats-next/C-use-and-suspense.md","nextSlug":"/lessons/whats-next/react-compiler","prevSlug":"/lessons/whats-next/form-actions"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"whats-next","slug":"use-and-suspense"},"buildId":"6cfMzZxR9Y4qzeGRDdjZd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>