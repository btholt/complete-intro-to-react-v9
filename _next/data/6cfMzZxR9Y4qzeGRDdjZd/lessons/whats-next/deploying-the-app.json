{"pageProps":{"post":{"attributes":{"description":"Take the client and API server applications into production. The React client app will be hosted on Netlify. The Node.js server API will be hosted on Render.","keywords":["Vite Build","Netlify","Render"]},"html":"<h2>Deploying</h2>\n<blockquote>\n<p>üìù Deploying was discussed, but not demonstrated in the course. You can follow the steps below if you would like to deploy the client and server applications.</p>\n</blockquote>\n<p>With React or any client-side framework, deployment is easy. Run <code>npm run build</code> to generate your HTML, CSS, and JS file with Vite and toss them on any static web host. This project is a little different because it calls an API from a local Node.js server. So that needs to be deployed too. What good is a pizza ordering website with out pizzas, right?</p>\n<p>To get both the client and server applications deployed, we&#39;ll have to do a little refactoring. We&#39;ll also introduces some best practices along the way. The React client app will be deployed to <a href=\"https://www.netlify.com/\">Netlify</a> and the Node.js server app will get deployed to <a href=\"https://render.com/\">Render</a>. Both platforms have free tiers and we&#39;ll use a <a href=\"https://github.com/\">GitHub</a> workflow to make deployment super easy.</p>\n<blockquote>\n<p>If you want to skip all the refactoring and just deploy the finished applications, you can use the code in the <code>pizza-client-app</code> and <code>pizza-server-app</code> directories in the <a href=\"https://github.com/btholt/citr-v9-project/tree/main/18-deploying\">18-deploying directory</a> in the repo.</p>\n</blockquote>\n<h3>Refactoring the Static Assets</h3>\n<p>Our CSS, fonts, and images are all currently hosted in the API server application. This was purely for convenience so they didn&#39;t need to be copied across each code checkpoint in the course. In the real world, these should be with the React application. </p>\n<p>Move the <code>public</code> folder from the API project to the React project:</p>\n<p><img src=\"/images/deploy-public.png\" alt=\"public folder in the VS Code file explorer\"></p>\n<p>Also, Vite assumes anything in the <code>public</code> directory lives at the root of the published files so open <code>style.css</code> and remove all the &quot;public&quot; references. For example, the font should load from:</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-attribute\">src</span>: <span class=\"hljs-built_in\">url</span>(<span class=\"hljs-string\">&quot;/Pacifico-Regular.ttf&quot;</span>);\n</code></pre><p>Lastly, update the stylesheet link in the <code>index.html</code> head: </p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">&quot;stylesheet&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/style.css&quot;</span> /&gt;</span>\n</code></pre><h3>Deploy the Node.js API Application</h3>\n<p>We still have some work to do in the React app, but let&#39;s get the server application deployed. This is a Node.js application built with Fastify so you need a host that supports Node. We&#39;re going to use <a href=\"https://render.com/\">Render</a> so create an account there if you haven&#39;t already.</p>\n<p>We&#39;re going to deploy it to Render with GitHub. Create a new GitHub repo for the API server. I&#39;m using <code>pizza-server-app</code>. Run <code>git init</code> in your local project and add your GitHub repo as a remote repository so we can push the app there when we&#39;re ready.</p>\n<p>Now to some refactoring. We moved the <code>/public</code> directory to the client app so we can delete the static file serving:</p>\n<pre><code class=\"hljs language-javascript\">server.<span class=\"hljs-title function_\">register</span>(fastifyStatic, {\n    ...\n});\n</code></pre><p>Our image paths need to be updated too. Remove every reference to <code>public</code> in the API responses. For example:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Any image property like this:</span>\n<span class=\"hljs-attr\">image</span>: <span class=\"hljs-string\">`/public/pizzas/<span class=\"hljs-subst\">${pizza.pizza_type_id}</span>.webp`</span>,\n\n<span class=\"hljs-comment\">// ...Should have public removed from it:</span>\n<span class=\"hljs-attr\">image</span>: <span class=\"hljs-string\">`/pizzas/<span class=\"hljs-subst\">${pizza.pizza_type_id}</span>.webp`</span>,\n</code></pre><p>There no reason we need a fake 5 second wait in a production application (it was added to slow down requests so we could see the loading states locally). Remove the Promise:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">await</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve</span>) =&gt;</span> <span class=\"hljs-built_in\">setTimeout</span>(resolve, <span class=\"hljs-number\">5000</span>));\n</code></pre><p>Who loves CORS? Since our client application is loading data from a separate server, we need to allow that. The Vite proxy fixed that issue for us locally, but that won&#39;t work in production. We&#39;re taking the easy way out and just allowing everything. Add this Fastify hook to the server and check out the Frontend Masters <a href=\"https://frontendmasters.com/courses/web-security-v2/\">Web Security course</a> to learn more about CORS.</p>\n<pre><code class=\"hljs language-javascript\">server.<span class=\"hljs-title function_\">addHook</span>(<span class=\"hljs-string\">&#x27;preHandler&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res, done</span>) =&gt;</span> {\n    res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>);\n    res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"hljs-string\">&quot;GET, POST&quot;</span>);\n    res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Headers&quot;</span>,  <span class=\"hljs-string\">&quot;*&quot;</span>);\n    <span class=\"hljs-keyword\">const</span> isPreflight = <span class=\"hljs-regexp\">/options/i</span>.<span class=\"hljs-title function_\">test</span>(req.<span class=\"hljs-property\">method</span>);\n    <span class=\"hljs-keyword\">if</span> (isPreflight) {\n        <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">send</span>();\n    }  \n    <span class=\"hljs-title function_\">done</span>();\n})\n</code></pre><p>Lastly, Render requires your application to bind the <code>host</code> property to <code>0.0.0.0</code> instead of <code>localhost</code>, so create a property and update the <code>server.listen()</code> method:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Create a HOST property after the PORT property</span>\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">HOST</span> = (<span class=\"hljs-string\">&quot;RENDER&quot;</span> <span class=\"hljs-keyword\">in</span> process.<span class=\"hljs-property\">env</span>) ? <span class=\"hljs-string\">`0.0.0.0`</span> : <span class=\"hljs-string\">`localhost`</span>;\n\n<span class=\"hljs-comment\">// pass it to the server.listen() method:</span>\n<span class=\"hljs-keyword\">await</span> server.<span class=\"hljs-title function_\">listen</span>({ <span class=\"hljs-attr\">host</span>: <span class=\"hljs-variable constant_\">HOST</span>, <span class=\"hljs-attr\">port</span>: <span class=\"hljs-variable constant_\">PORT</span> });\n</code></pre><h3>Deploy to Render</h3>\n<p>Ok, we are ready to deploy. Push your code to your GitHub repo.</p>\n<p><img src=\"/images/deploy-repo.png\" alt=\"Node.js server application files in a GitHub repo\"></p>\n<p>Head over to the <a href=\"https://dashboard.render.com/\">Render Dashboard</a> and <strong>Deploy a New Web Service</strong>. Connect your GitHub account and choose the <code>pizza-server-app</code> repo (or whatever you called yours) as the source code for the project. All the defaults should work, however, make sure you select Free/Hobby tier for the server instance type.</p>\n<p>Once your server has deployed, you‚Äôll be able to access it by the URL displayed in your dashboard. You can test it by accessing the <code>[yourserver]/api/pizzas</code> endpoint:</p>\n<p><img src=\"/images/deploy-render.png\" alt=\"Node.js server application files in a GitHub repo\"></p>\n<p>Your server API is deployed! And the cool thing about this is any time you push to your repo, it will automatically redeploy to Render.</p>\n<h3>Deploying the Client Application</h3>\n<p>Before we deploy the client application, we need to tweak a few things. We have a local development API server and a remote production API server -- both with two different URLs. We don&#39;t want these hard-coded in our application nor do we want to worry about switching the URL when we build our app. We&#39;re going to use some Vite environment variables to help us. Create two files in the root: <code>.env.development</code> and <code>.env.production</code>. Then add a <code>VITE_API_URL</code> to each:</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># Add this to .env.development</span>\nVITE_API_URL=<span class=\"hljs-string\">&quot;&quot;</span>\n\n\n<span class=\"hljs-comment\"># Add this to .env.production</span>\nVITE_API_URL=<span class=\"hljs-string\">&quot;https://[YOUR-SERVER-URL].onrender.com&quot;</span>\n</code></pre><p>You can learn more about this in our <a href=\"https://frontendmasters.com/courses/vite/\">Vite course</a>, but the short version is these variables are added to the <code>import.meta.env</code> property by Vite (depending on it being development or production/build). We are not ignoring these files in Git so you wouldn&#39;t want any sensitive data added to these environment files. If we are running <code>npm run build</code>, add our production URL. If we are running <code>npm run dev</code> don&#39;t add anything -- because our local proxy will handle it.</p>\n<p>Speaking of proxy, you can remove the <code>/public</code> proxy from the <code>vite.config.js</code> file. Now let&#39;s use <code>VITE_API_URL</code>. Find our three API helpers (getPastOrders.js, getPastOrder.js, and usePizzaOfTheDay.js) and update the fetch call to use the environment variable. For example:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">const</span> apiUrl = <span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">VITE_API_URL</span>;\n<span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${apiUrl}</span>/api/past-order/<span class=\"hljs-subst\">${order}</span>`</span>);\n</code></pre><p>You&#39;ll also need to do this in <code>order.lazy.jsx</code>:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// create the property at the top</span>\n<span class=\"hljs-keyword\">const</span> apiUrl = <span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">VITE_API_URL</span>;\n\n<span class=\"hljs-comment\">// update checkout</span>\n<span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${apiUrl}</span>/api/order`</span>, {\n...\n})\n\n<span class=\"hljs-comment\">// update fetchPizzaTypes</span>\n<span class=\"hljs-keyword\">const</span> pizzasRes = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${apiUrl}</span>/api/pizzas`</span>);\n</code></pre><h3>Deploy to Netlify</h3>\n<p>Whew! I think that&#39;s it. Push your code up to a septate GitHub repo. We&#39;re now ready to deploy!</p>\n<p><img src=\"/images/deploy-client-repo.png\" alt=\"React client app files in a GitHub repo\"></p>\n<p> Head over to <a href=\"https://www.netlify.com/\">Netilfy</a>, create an account if you don&#39;t already have one, and click to create a new site. You‚Äôll choose to import a project from GitHub:</p>\n<p><img src=\"/images/deploy-netlify.png\" alt=\"Choosing a repo in Netlify\"></p>\n<p>When configuring the project, the defaults should work:</p>\n<p><img src=\"/images/deploy-netlify-config.png\" alt=\"Netlify configuration settings\"></p>\n<p>Once your site is deployed, you should be able to access it with the name you selected during the setup. For example, https://[Your-App-Name].netlify.app. </p>\n<h3>Congrats!</h3>\n<p>You now have a client React application deployed to Netlify and a Node.js server API deployed to Render!</p>\n","markdown":"\n## Deploying\n\n> üìù Deploying was discussed, but not demonstrated in the course. You can follow the steps below if you would like to deploy the client and server applications.\n\nWith React or any client-side framework, deployment is easy. Run `npm run build` to generate your HTML, CSS, and JS file with Vite and toss them on any static web host. This project is a little different because it calls an API from a local Node.js server. So that needs to be deployed too. What good is a pizza ordering website with out pizzas, right?\n\nTo get both the client and server applications deployed, we'll have to do a little refactoring. We'll also introduces some best practices along the way. The React client app will be deployed to [Netlify](https://www.netlify.com/) and the Node.js server app will get deployed to [Render](https://render.com/). Both platforms have free tiers and we'll use a [GitHub](https://github.com/) workflow to make deployment super easy.\n\n> If you want to skip all the refactoring and just deploy the finished applications, you can use the code in the `pizza-client-app` and `pizza-server-app` directories in the [18-deploying directory](https://github.com/btholt/citr-v9-project/tree/main/18-deploying) in the repo.\n\n### Refactoring the Static Assets\n\nOur CSS, fonts, and images are all currently hosted in the API server application. This was purely for convenience so they didn't need to be copied across each code checkpoint in the course. In the real world, these should be with the React application. \n\nMove the `public` folder from the API project to the React project:\n\n![public folder in the VS Code file explorer](/images/deploy-public.png)\n\nAlso, Vite assumes anything in the `public` directory lives at the root of the published files so open `style.css` and remove all the \"public\" references. For example, the font should load from:\n\n```css\nsrc: url(\"/Pacifico-Regular.ttf\");\n```\n\nLastly, update the stylesheet link in the `index.html` head: \n\n```html\n<link rel=\"stylesheet\" href=\"/style.css\" />\n```\n\n### Deploy the Node.js API Application\n\nWe still have some work to do in the React app, but let's get the server application deployed. This is a Node.js application built with Fastify so you need a host that supports Node. We're going to use [Render](https://render.com/) so create an account there if you haven't already.\n\nWe're going to deploy it to Render with GitHub. Create a new GitHub repo for the API server. I'm using `pizza-server-app`. Run `git init` in your local project and add your GitHub repo as a remote repository so we can push the app there when we're ready.\n\nNow to some refactoring. We moved the `/public` directory to the client app so we can delete the static file serving:\n\n```javascript\nserver.register(fastifyStatic, {\n    ...\n});\n```\n\nOur image paths need to be updated too. Remove every reference to `public` in the API responses. For example:\n\n```javascript\n// Any image property like this:\nimage: `/public/pizzas/${pizza.pizza_type_id}.webp`,\n\n// ...Should have public removed from it:\nimage: `/pizzas/${pizza.pizza_type_id}.webp`,\n```\n\nThere no reason we need a fake 5 second wait in a production application (it was added to slow down requests so we could see the loading states locally). Remove the Promise:\n\n```javascript\nawait new Promise((resolve) => setTimeout(resolve, 5000));\n```\n\nWho loves CORS? Since our client application is loading data from a separate server, we need to allow that. The Vite proxy fixed that issue for us locally, but that won't work in production. We're taking the easy way out and just allowing everything. Add this Fastify hook to the server and check out the Frontend Masters [Web Security course](https://frontendmasters.com/courses/web-security-v2/) to learn more about CORS.\n\n```javascript\nserver.addHook('preHandler', (req, res, done) => {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Methods\", \"GET, POST\");\n    res.header(\"Access-Control-Allow-Headers\",  \"*\");\n    const isPreflight = /options/i.test(req.method);\n    if (isPreflight) {\n        return res.send();\n    }  \n    done();\n})\n```\n\nLastly, Render requires your application to bind the `host` property to `0.0.0.0` instead of `localhost`, so create a property and update the `server.listen()` method:\n\n```javascript\n// Create a HOST property after the PORT property\nconst HOST = (\"RENDER\" in process.env) ? `0.0.0.0` : `localhost`;\n\n// pass it to the server.listen() method:\nawait server.listen({ host: HOST, port: PORT });\n```\n\n### Deploy to Render\n\nOk, we are ready to deploy. Push your code to your GitHub repo.\n\n![Node.js server application files in a GitHub repo](/images/deploy-repo.png)\n\nHead over to the [Render Dashboard](https://dashboard.render.com/) and **Deploy a New Web Service**. Connect your GitHub account and choose the `pizza-server-app` repo (or whatever you called yours) as the source code for the project. All the defaults should work, however, make sure you select Free/Hobby tier for the server instance type.\n\nOnce your server has deployed, you‚Äôll be able to access it by the URL displayed in your dashboard. You can test it by accessing the `[yourserver]/api/pizzas` endpoint:\n\n![Node.js server application files in a GitHub repo](/images/deploy-render.png)\n\nYour server API is deployed! And the cool thing about this is any time you push to your repo, it will automatically redeploy to Render.\n\n### Deploying the Client Application\n\nBefore we deploy the client application, we need to tweak a few things. We have a local development API server and a remote production API server -- both with two different URLs. We don't want these hard-coded in our application nor do we want to worry about switching the URL when we build our app. We're going to use some Vite environment variables to help us. Create two files in the root: `.env.development` and `.env.production`. Then add a `VITE_API_URL` to each:\n\n```bash\n# Add this to .env.development\nVITE_API_URL=\"\"\n\n\n# Add this to .env.production\nVITE_API_URL=\"https://[YOUR-SERVER-URL].onrender.com\"\n\n```\n\nYou can learn more about this in our [Vite course](https://frontendmasters.com/courses/vite/), but the short version is these variables are added to the `import.meta.env` property by Vite (depending on it being development or production/build). We are not ignoring these files in Git so you wouldn't want any sensitive data added to these environment files. If we are running `npm run build`, add our production URL. If we are running `npm run dev` don't add anything -- because our local proxy will handle it.\n\nSpeaking of proxy, you can remove the `/public` proxy from the `vite.config.js` file. Now let's use `VITE_API_URL`. Find our three API helpers (getPastOrders.js, getPastOrder.js, and usePizzaOfTheDay.js) and update the fetch call to use the environment variable. For example:\n\n```javascript\nconst apiUrl = import.meta.env.VITE_API_URL;\nconst response = await fetch(`${apiUrl}/api/past-order/${order}`);\n```\n\nYou'll also need to do this in `order.lazy.jsx`:\n\n```javascript\n// create the property at the top\nconst apiUrl = import.meta.env.VITE_API_URL;\n\n// update checkout\nawait fetch(`${apiUrl}/api/order`, {\n...\n})\n\n// update fetchPizzaTypes\nconst pizzasRes = await fetch(`${apiUrl}/api/pizzas`);\n```\n\n### Deploy to Netlify\n\nWhew! I think that's it. Push your code up to a septate GitHub repo. We're now ready to deploy!\n\n![React client app files in a GitHub repo](/images/deploy-client-repo.png)\n\n Head over to [Netilfy](https://www.netlify.com/), create an account if you don't already have one, and click to create a new site. You‚Äôll choose to import a project from GitHub:\n\n![Choosing a repo in Netlify](/images/deploy-netlify.png)\n\nWhen configuring the project, the defaults should work:\n\n![Netlify configuration settings](/images/deploy-netlify-config.png)\n\nOnce your site is deployed, you should be able to access it with the name you selected during the setup. For example, https://[Your-App-Name].netlify.app. \n\n### Congrats!\n\nYou now have a client React application deployed to Netlify and a Node.js server API deployed to Render!\n\n\n\n\n\n\n","slug":"deploying-the-app","title":"Deploying the App","section":"Whats Next","icon":"shuttle-space","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/08-whats-next/E-deploying-the-app.md","nextSlug":"/lessons/wrap-up/congrats","prevSlug":"/lessons/whats-next/react-compiler"}},"__N_SSG":true}