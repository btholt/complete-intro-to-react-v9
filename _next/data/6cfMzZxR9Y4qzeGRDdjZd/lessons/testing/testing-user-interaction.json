{"pageProps":{"post":{"attributes":{"description":"Learn how to test a Contact page in React using Vitest and vitest-fetch-mock, a tool to simplify fetch mocking. The tutorial covers setting up mocks, rendering components with React Query's QueryClientProvider, filling out form inputs, simulating user interactions, and verifying API requests, providing a comprehensive guide for beginner to job-ready React developers under guidance from Brian Holt, creator of the Complete Intro to React course, version 9.","keywords":["React testing","Vitest","vitest-fetch-mock","React Query","Contact form testing"]},"html":"<p>Let&#39;s test the Contact page. It has a nice, simple user interaction. User puts their information in, we submit to the API, and we show them a submitted header. Let&#39;s test all of that.</p>\n<p>First we need a helper function, vitest-fetch-mock. We don&#39;t <em>need</em> it because Vitest can do it, but I think it just makes things easier.</p>\n<pre><code class=\"hljs language-bash\">npm i -D vitest-fetch-mock@0.3.0\n</code></pre><p>And now let&#39;s write the code</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { render } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@testing-library/react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { expect, test, vi } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;vitest&quot;</span>;\n<span class=\"hljs-keyword\">import</span> createFetchMock <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;vitest-fetch-mock&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">QueryClientProvider</span>, <span class=\"hljs-title class_\">QueryClient</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@tanstack/react-query&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Route</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../routes/contact.lazy&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> queryClient = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">QueryClient</span>();\n\n<span class=\"hljs-keyword\">const</span> fetchMocker = <span class=\"hljs-title function_\">createFetchMock</span>(vi);\nfetchMocker.<span class=\"hljs-title function_\">enableMocks</span>();\n\n<span class=\"hljs-title function_\">test</span>(<span class=\"hljs-string\">&quot;can submit contact form&quot;</span>, <span class=\"hljs-title function_\">async</span> () =&gt; {\n  fetchMocker.<span class=\"hljs-title function_\">mockResponse</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>({ <span class=\"hljs-attr\">status</span>: <span class=\"hljs-string\">&quot;ok&quot;</span> }));\n  <span class=\"hljs-keyword\">const</span> screen = <span class=\"hljs-title function_\">render</span>(\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">QueryClientProvider</span> <span class=\"hljs-attr\">client</span>=<span class=\"hljs-string\">{queryClient}</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Route.options.component</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">QueryClientProvider</span>&gt;</span></span>\n  );\n\n  <span class=\"hljs-keyword\">const</span> nameInput = screen.<span class=\"hljs-title function_\">getByPlaceholderText</span>(<span class=\"hljs-string\">&quot;Name&quot;</span>);\n  <span class=\"hljs-keyword\">const</span> emailInput = screen.<span class=\"hljs-title function_\">getByPlaceholderText</span>(<span class=\"hljs-string\">&quot;Email&quot;</span>);\n  <span class=\"hljs-keyword\">const</span> msgTextArea = screen.<span class=\"hljs-title function_\">getByPlaceholderText</span>(<span class=\"hljs-string\">&quot;Message&quot;</span>);\n\n  <span class=\"hljs-keyword\">const</span> testData = {\n    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Brian&quot;</span>,\n    <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">&quot;test@example.com&quot;</span>,\n    <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">&quot;This is a test message&quot;</span>,\n  };\n\n  nameInput.<span class=\"hljs-property\">value</span> = testData.<span class=\"hljs-property\">name</span>;\n  emailInput.<span class=\"hljs-property\">value</span> = testData.<span class=\"hljs-property\">email</span>;\n  msgTextArea.<span class=\"hljs-property\">value</span> = testData.<span class=\"hljs-property\">message</span>;\n\n  <span class=\"hljs-keyword\">const</span> btn = screen.<span class=\"hljs-title function_\">getByRole</span>(<span class=\"hljs-string\">&quot;button&quot;</span>);\n\n  btn.<span class=\"hljs-title function_\">click</span>();\n\n  <span class=\"hljs-keyword\">const</span> h3 = <span class=\"hljs-keyword\">await</span> screen.<span class=\"hljs-title function_\">findByRole</span>(<span class=\"hljs-string\">&quot;heading&quot;</span>, { <span class=\"hljs-attr\">level</span>: <span class=\"hljs-number\">3</span> });\n\n  <span class=\"hljs-title function_\">expect</span>(h3.<span class=\"hljs-property\">innerText</span>).<span class=\"hljs-title function_\">toContain</span>(<span class=\"hljs-string\">&quot;Submitted&quot;</span>);\n\n  <span class=\"hljs-keyword\">const</span> requests = fetchMocker.<span class=\"hljs-title function_\">requests</span>();\n  <span class=\"hljs-title function_\">expect</span>(requests.<span class=\"hljs-property\">length</span>).<span class=\"hljs-title function_\">toBe</span>(<span class=\"hljs-number\">1</span>);\n  <span class=\"hljs-title function_\">expect</span>(requests[<span class=\"hljs-number\">0</span>].<span class=\"hljs-property\">url</span>).<span class=\"hljs-title function_\">toBe</span>(<span class=\"hljs-string\">&quot;/api/contact&quot;</span>);\n  <span class=\"hljs-title function_\">expect</span>(fetchMocker).<span class=\"hljs-title function_\">toHaveBeenCalledWith</span>(<span class=\"hljs-string\">&quot;/api/contact&quot;</span>, {\n    <span class=\"hljs-attr\">body</span>: <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(testData),\n    <span class=\"hljs-attr\">headers</span>: {\n      <span class=\"hljs-string\">&quot;Content-Type&quot;</span>: <span class=\"hljs-string\">&quot;application/json&quot;</span>,\n    },\n    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span>,\n  });\n});\n</code></pre><ul>\n<li>We need to wrap React Query with a query provider always or it doesn&#39;t work. In this case we can just make that part of the initial render.</li>\n<li>You can pre-populate React Query with a valid cache and then test if your app uses that correctly. Totally valid way to test. In this case we want to make sure our endpoint is being posted to correctly (to make sure we record a contact)so we aren&#39;t doing that.</li>\n<li><code>vi</code> is Vitest&#39;s spy library, similar to sinon.</li>\n<li>vitest-fetch-mock is just a nice layer on top of vi. We could just use vi directly.</li>\n<li>Notice we can just call <code>click</code> and it does all the things we&#39;d expect. Cool, right?</li>\n<li>We then make some assertions that our h3 shows up correctly, that our API was called once, and that it was submitted to our API the way we expect it to. This may seem a bit implementation-oriented, and it is, but typically in a larger app we&#39;d have a library for calling our API and we&#39;d test that individually but we don&#39;t here so we&#39;re wrapping it all together.</li>\n</ul>\n","markdown":"Let's test the Contact page. It has a nice, simple user interaction. User puts their information in, we submit to the API, and we show them a submitted header. Let's test all of that.\n\nFirst we need a helper function, vitest-fetch-mock. We don't _need_ it because Vitest can do it, but I think it just makes things easier.\n\n```bash\nnpm i -D vitest-fetch-mock@0.3.0\n```\n\nAnd now let's write the code\n\n```javascript\nimport { render } from \"@testing-library/react\";\nimport { expect, test, vi } from \"vitest\";\nimport createFetchMock from \"vitest-fetch-mock\";\nimport { QueryClientProvider, QueryClient } from \"@tanstack/react-query\";\nimport { Route } from \"../routes/contact.lazy\";\n\nconst queryClient = new QueryClient();\n\nconst fetchMocker = createFetchMock(vi);\nfetchMocker.enableMocks();\n\ntest(\"can submit contact form\", async () => {\n  fetchMocker.mockResponse(JSON.stringify({ status: \"ok\" }));\n  const screen = render(\n    <QueryClientProvider client={queryClient}>\n      <Route.options.component />\n    </QueryClientProvider>\n  );\n\n  const nameInput = screen.getByPlaceholderText(\"Name\");\n  const emailInput = screen.getByPlaceholderText(\"Email\");\n  const msgTextArea = screen.getByPlaceholderText(\"Message\");\n\n  const testData = {\n    name: \"Brian\",\n    email: \"test@example.com\",\n    message: \"This is a test message\",\n  };\n\n  nameInput.value = testData.name;\n  emailInput.value = testData.email;\n  msgTextArea.value = testData.message;\n\n  const btn = screen.getByRole(\"button\");\n\n  btn.click();\n\n  const h3 = await screen.findByRole(\"heading\", { level: 3 });\n\n  expect(h3.innerText).toContain(\"Submitted\");\n\n  const requests = fetchMocker.requests();\n  expect(requests.length).toBe(1);\n  expect(requests[0].url).toBe(\"/api/contact\");\n  expect(fetchMocker).toHaveBeenCalledWith(\"/api/contact\", {\n    body: JSON.stringify(testData),\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    method: \"POST\",\n  });\n});\n```\n\n- We need to wrap React Query with a query provider always or it doesn't work. In this case we can just make that part of the initial render.\n- You can pre-populate React Query with a valid cache and then test if your app uses that correctly. Totally valid way to test. In this case we want to make sure our endpoint is being posted to correctly (to make sure we record a contact)so we aren't doing that.\n- `vi` is Vitest's spy library, similar to sinon.\n- vitest-fetch-mock is just a nice layer on top of vi. We could just use vi directly.\n- Notice we can just call `click` and it does all the things we'd expect. Cool, right?\n- We then make some assertions that our h3 shows up correctly, that our API was called once, and that it was submitted to our API the way we expect it to. This may seem a bit implementation-oriented, and it is, but typically in a larger app we'd have a library for calling our API and we'd test that individually but we don't here so we're wrapping it all together.\n","slug":"testing-user-interaction","title":"Testing User Interaction","section":"Testing","icon":"vial","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/07-testing/C-testing-user-interaction.md","nextSlug":"/lessons/testing/testing-custom-hooks","prevSlug":"/lessons/testing/basic-react-tests"}},"__N_SSG":true}