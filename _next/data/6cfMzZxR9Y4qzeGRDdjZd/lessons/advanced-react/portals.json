{"pageProps":{"post":{"attributes":{"description":"Learn how to implement a React modal using portals for rendering components outside the main app structure in Brian Holt's \"Complete Intro to React.\" This guide covers use of React Query for asynchronous data management and demonstrates best practices in creating user interface elements like modals to improve web development skills. Ideal for React developers seeking practical experience with advanced rendering techniques and API integration.","keywords":["React modals","portals","React Query","web development","Brian Holt"]},"html":"<h2>Portals</h2>\n<p>What if you are rendering a page and you want to render something in another part of the page at the same time? Think like you have a contextual right navigation and you have a page that wants to render into the contextual nav. We could use something like context to do that and that would be totally acceptable. But there&#39;s another cool way called a portal to do this as well. It even lets us render outside our app totally, like we&#39;re about to do.</p>\n<p>We&#39;re going to do a modal or a &quot;popover&quot;. I think these are bad user experiences but it&#39;s a perfect use case for a portal so we&#39;re going to do it! In our case, because we want the modal to render in front of everything, we need the div that the modal renders into to be first in the DOM. So let&#39;s go make a div that does that. Open your index.html file and put this in there.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// above #root</span>\n&lt;div id=<span class=\"hljs-string\">&quot;modal&quot;</span>&gt;&lt;/div&gt;\n</code></pre><p>By default this will have nothing in it, but once we render our modal it render inside this div instead of root. Make a new file in src called Modal.jsx</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// basically stolen from the React docs</span>\n<span class=\"hljs-keyword\">import</span> { useEffect, useRef } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { createPortal } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react-dom&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Modal</span> = (<span class=\"hljs-params\">{ children }</span>) =&gt; {\n  <span class=\"hljs-keyword\">const</span> elRef = <span class=\"hljs-title function_\">useRef</span>(<span class=\"hljs-literal\">null</span>);\n  <span class=\"hljs-keyword\">if</span> (!elRef.<span class=\"hljs-property\">current</span>) {\n    elRef.<span class=\"hljs-property\">current</span> = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&quot;div&quot;</span>);\n  }\n\n  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-keyword\">const</span> modalRoot = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;modal&quot;</span>);\n    modalRoot.<span class=\"hljs-title function_\">appendChild</span>(elRef.<span class=\"hljs-property\">current</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> modalRoot.<span class=\"hljs-title function_\">removeChild</span>(elRef.<span class=\"hljs-property\">current</span>);\n  }, []);\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">createPortal</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>{children}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>, elRef.<span class=\"hljs-property\">current</span>);\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">Modal</span>;\n</code></pre><ul>\n<li>This uses a ref. A ref is a reference to something that need to be exactly the same between renders. A hook would get regenerated / recreated so we need a ref because it&#39;ll create a div and then it hand back the <em>same</em> div every render. It&#39;s important that it&#39;s the same div because it&#39;ll be the one we use to render the portal.</li>\n<li>We&#39;re using createPortal to render into this new modal div we&#39;re chosen for our modal. But this could be a contextual nav or any other DOM div we want.</li>\n<li>We use the returned function on the effect to clean up when this Modal is unmounted from the DOM. Otherwise we&#39;d leak memory.</li>\n</ul>\n<p>Before we use our Modal, we&#39;ll need to make another API call function get a past order. In our example here, we&#39;re going to make it so you can click on one of the rows in our past orders page to see what was in the order. In <code>src/api</code>, add a file called <code>getPastOrder.js</code> (no <code>s</code>) and add this.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getPastOrder</span>(<span class=\"hljs-params\">order</span>) {\n  <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`/api/past-order/<span class=\"hljs-subst\">${order}</span>`</span>);\n  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> response.<span class=\"hljs-title function_\">json</span>();\n  <span class=\"hljs-keyword\">return</span> data;\n}\n</code></pre><p>Then render the modal if we have a <code>focusedOrder</code>: </p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// import at top</span>\n<span class=\"hljs-keyword\">import</span> getPastOrder <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../api/getPastOrder&quot;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Modal</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Modal&quot;</span>;\n\n<span class=\"hljs-comment\">// <span class=\"hljs-doctag\">NOTE:</span> In the course, Brian makes this a hook/module</span>\n<span class=\"hljs-keyword\">const</span> intl = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Intl</span>.<span class=\"hljs-title class_\">NumberFormat</span>(<span class=\"hljs-string\">&quot;en-US&quot;</span>, {\n  <span class=\"hljs-attr\">style</span>: <span class=\"hljs-string\">&quot;currency&quot;</span>,\n  <span class=\"hljs-attr\">currency</span>: <span class=\"hljs-string\">&quot;USD&quot;</span>,\n});\n\n<span class=\"hljs-comment\">// top of the render function</span>\n<span class=\"hljs-keyword\">const</span> [focusedOrder, setFocusedOrder] = <span class=\"hljs-title function_\">useState</span>();\n\n<span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">isLoading</span>: isLoadingPastOrder, <span class=\"hljs-attr\">data</span>: pastOrderData } = <span class=\"hljs-title function_\">useQuery</span>({\n  <span class=\"hljs-attr\">queryKey</span>: [<span class=\"hljs-string\">&quot;past-order&quot;</span>, focusedOrder],\n  <span class=\"hljs-attr\">queryFn</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">getPastOrder</span>(focusedOrder),\n  <span class=\"hljs-attr\">enabled</span>: !!focusedOrder,\n  <span class=\"hljs-attr\">staleTime</span>: <span class=\"hljs-number\">24</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span>, <span class=\"hljs-comment\">// one day in milliseconds,</span>\n});\n\n<span class=\"hljs-comment\">// last thing before closing div</span>\n{\n  focusedOrder ? (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Modal</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>Order #{focusedOrder}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n      {!isLoadingPastOrder ? (\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">thead</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tr</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Image<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Name<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Size<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Quantity<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Price<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>Total<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tr</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">thead</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tbody</span>&gt;</span>\n            {pastOrderData.orderItems.map((pizza) =&gt; (\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tr</span> <span class=\"hljs-attr\">key</span>=<span class=\"hljs-string\">{</span>`${<span class=\"hljs-attr\">pizza.pizzaTypeId</span>}<span class=\"hljs-attr\">_</span>${<span class=\"hljs-attr\">pizza.size</span>}`}&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>\n                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">{pizza.image}</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">{pizza.name}</span> /&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{pizza.name}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{pizza.size}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{pizza.quantity}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{intl.format(pizza.price)}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{intl.format(pizza.total)}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tr</span>&gt;</span>\n            ))}\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tbody</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span>\n      ) : (\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>Loading …<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n      )}\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{()</span> =&gt;</span> setFocusedOrder()}&gt;Close<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Modal</span>&gt;</span></span>\n  ) : <span class=\"hljs-literal\">null</span>\n}\n</code></pre><ul>\n<li>We&#39;re using React Query again here. We&#39;re using the <code>enabled</code> key to only make this request when the user has set a focusedOrder. If there&#39;s no focusedOrder, then it won&#39;t make the request. <code>!!</code> is the same as &quot;not not&quot;. It makes a number like <code>5</code> be <code>true</code> and a number like <code>0</code> or <code>undefined</code> be <code>false</code>.</li>\n<li>We set the staleTime to day. These orders shouldn&#39;t change very frequently.</li>\n<li>If there&#39;s no focusedOrder, we don&#39;t render the Modal, which means the portal is unused.</li>\n<li>If there is a focusedOrder, we render the modal and show a loading indicator that we&#39;re loading the rest of the info.</li>\n<li>When a user clicks Close, we set the focusedOrder to be undefined again which causes the Modal to unrender.</li>\n</ul>\n<p>Finally, we need a way to open the modal. Open <code>past.lazy.jsx</code>. Make the <code>order.order_id</code> value a button and add an <code>onClick</code> event so clicking it will open the Modal:</p>\n<pre><code class=\"hljs language-javascript\">&lt;td&gt;\n  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{()</span> =&gt;</span> setFocusedOrder(order.order_id)}&gt;\n    {order.order_id}\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span>\n&lt;/td&gt;\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{order.date}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>{order.time}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span></span>\n</code></pre><p>That&#39;s it!</p>\n<blockquote>\n<p>🏁 <a href=\"https://github.com/btholt/citr-v9-project/tree/master/11-modals\">Click here to see the state of the project up until now: 11-modals</a></p>\n</blockquote>\n","markdown":"\n## Portals\n\nWhat if you are rendering a page and you want to render something in another part of the page at the same time? Think like you have a contextual right navigation and you have a page that wants to render into the contextual nav. We could use something like context to do that and that would be totally acceptable. But there's another cool way called a portal to do this as well. It even lets us render outside our app totally, like we're about to do.\n\nWe're going to do a modal or a \"popover\". I think these are bad user experiences but it's a perfect use case for a portal so we're going to do it! In our case, because we want the modal to render in front of everything, we need the div that the modal renders into to be first in the DOM. So let's go make a div that does that. Open your index.html file and put this in there.\n\n```javascript\n// above #root\n<div id=\"modal\"></div>\n```\n\nBy default this will have nothing in it, but once we render our modal it render inside this div instead of root. Make a new file in src called Modal.jsx\n\n```javascript\n// basically stolen from the React docs\nimport { useEffect, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nconst Modal = ({ children }) => {\n  const elRef = useRef(null);\n  if (!elRef.current) {\n    elRef.current = document.createElement(\"div\");\n  }\n\n  useEffect(() => {\n    const modalRoot = document.getElementById(\"modal\");\n    modalRoot.appendChild(elRef.current);\n    return () => modalRoot.removeChild(elRef.current);\n  }, []);\n\n  return createPortal(<div>{children}</div>, elRef.current);\n};\n\nexport default Modal;\n```\n\n- This uses a ref. A ref is a reference to something that need to be exactly the same between renders. A hook would get regenerated / recreated so we need a ref because it'll create a div and then it hand back the _same_ div every render. It's important that it's the same div because it'll be the one we use to render the portal.\n- We're using createPortal to render into this new modal div we're chosen for our modal. But this could be a contextual nav or any other DOM div we want.\n- We use the returned function on the effect to clean up when this Modal is unmounted from the DOM. Otherwise we'd leak memory.\n\nBefore we use our Modal, we'll need to make another API call function get a past order. In our example here, we're going to make it so you can click on one of the rows in our past orders page to see what was in the order. In `src/api`, add a file called `getPastOrder.js` (no `s`) and add this.\n\n```javascript\nexport default async function getPastOrder(order) {\n  const response = await fetch(`/api/past-order/${order}`);\n  const data = await response.json();\n  return data;\n}\n```\n\nThen render the modal if we have a `focusedOrder`: \n\n```javascript\n// import at top\nimport getPastOrder from \"../api/getPastOrder\";\nimport Modal from \"../Modal\";\n\n// NOTE: In the course, Brian makes this a hook/module\nconst intl = new Intl.NumberFormat(\"en-US\", {\n  style: \"currency\",\n  currency: \"USD\",\n});\n\n// top of the render function\nconst [focusedOrder, setFocusedOrder] = useState();\n\nconst { isLoading: isLoadingPastOrder, data: pastOrderData } = useQuery({\n  queryKey: [\"past-order\", focusedOrder],\n  queryFn: () => getPastOrder(focusedOrder),\n  enabled: !!focusedOrder,\n  staleTime: 24 * 60 * 60 * 1000, // one day in milliseconds,\n});\n\n// last thing before closing div\n{\n  focusedOrder ? (\n    <Modal>\n      <h2>Order #{focusedOrder}</h2>\n      {!isLoadingPastOrder ? (\n        <table>\n          <thead>\n            <tr>\n              <td>Image</td>\n              <td>Name</td>\n              <td>Size</td>\n              <td>Quantity</td>\n              <td>Price</td>\n              <td>Total</td>\n            </tr>\n          </thead>\n          <tbody>\n            {pastOrderData.orderItems.map((pizza) => (\n              <tr key={`${pizza.pizzaTypeId}_${pizza.size}`}>\n                <td>\n                  <img src={pizza.image} alt={pizza.name} />\n                </td>\n                <td>{pizza.name}</td>\n                <td>{pizza.size}</td>\n                <td>{pizza.quantity}</td>\n                <td>{intl.format(pizza.price)}</td>\n                <td>{intl.format(pizza.total)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      ) : (\n        <p>Loading …</p>\n      )}\n      <button onClick={() => setFocusedOrder()}>Close</button>\n    </Modal>\n  ) : null\n}\n```\n\n- We're using React Query again here. We're using the `enabled` key to only make this request when the user has set a focusedOrder. If there's no focusedOrder, then it won't make the request. `!!` is the same as \"not not\". It makes a number like `5` be `true` and a number like `0` or `undefined` be `false`.\n- We set the staleTime to day. These orders shouldn't change very frequently.\n- If there's no focusedOrder, we don't render the Modal, which means the portal is unused.\n- If there is a focusedOrder, we render the modal and show a loading indicator that we're loading the rest of the info.\n- When a user clicks Close, we set the focusedOrder to be undefined again which causes the Modal to unrender.\n\nFinally, we need a way to open the modal. Open `past.lazy.jsx`. Make the `order.order_id` value a button and add an `onClick` event so clicking it will open the Modal:\n\n```javascript\n<td>\n  <button onClick={() => setFocusedOrder(order.order_id)}>\n    {order.order_id}\n  </button>\n</td>\n<td>{order.date}</td>\n<td>{order.time}</td>\n```\n\n\nThat's it!\n\n> 🏁 [Click here to see the state of the project up until now: 11-modals][step]\n\n[step]: https://github.com/btholt/citr-v9-project/tree/master/11-modals\n","slug":"portals","title":"Portals","section":"Advanced React","icon":"dumbbell","filePath":"/home/runner/work/complete-intro-to-react-v9/complete-intro-to-react-v9/lessons/06-advanced-react/A-portals.md","nextSlug":"/lessons/advanced-react/error-boundaries","prevSlug":"/lessons/ecosystem/tanstack-query"}},"__N_SSG":true}